"use strict";(self.webpackChunkpetrvs=self.webpackChunkpetrvs||[]).push([[970],{2970:(li,oa,s)=>{s.r(oa),s.d(oa,{PlanoTrabalhoModule:()=>ni});var h=s(6733),ia=s(5579),b=s(1391),v=s(2314),d=s(8239),D=s(4040),na=s(5026),w=s(7744),la=s(2214),Pa=s(8340),ra=s(6075),N=s(1214),G=s(5255),sa=s(9084),O=s(762),da=s(1184),Ua=s(2307),a=s(755),J=s(8820),wa=s(1823),y=s(8967),z=s(2392),M=s(4495),I=s(5560),ca=s(3417);const Na=["usuario"],Ja=["unidade"],Qa=["programa"],Sa=["tipoDocumento"],Ra=["tipoModalidade"];let Ma=(()=>{class i extends da.F{constructor(t){super(t,O.p,w.t),this.injector=t,this.validate=(e,o)=>{let n=null;return"tipo_documento_id"==o&&!e?.value?.length&&this.form?.controls?.numero_processo?.value?.length&&(n="Obrigat\xf3rio"),n},this.formValidation=e=>{if(!this.tipoDocumento?.selectedEntity&&e?.controls.tipo_documento_id.value?.length)return"Aguarde o carregamento do tipo de documento"},this.titleEdit=e=>"Editando "+this.lex.translate("TCR")+" "+this.lex.translate("do Plano de Trabalho")+": "+(e?.usuario?.nome||""),this.join=["unidade","usuario","programa.template_tcr","tipo_modalidade","documento","documentos","atividades.atividade"],this.unidadeDao=t.get(N.J),this.programaDao=t.get(la.w),this.usuarioDao=t.get(G.q),this.tipoDocumentoDao=t.get(Pa.Q),this.allPages=t.get(sa.T),this.tipoModalidadeDao=t.get(ra.D),this.documentoDao=t.get(na.d),this.form=this.fh.FormBuilder({carga_horaria:{default:""},tempo_total:{default:""},tempo_proporcional:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},programa_id:{default:""},usuario_id:{default:""},unidade_id:{default:""},documento_id:{default:""},documentos:{default:[]},tipo_documento_id:{default:""},numero_processo:{default:""},vinculadas:{default:!0},tipo_modalidade_id:{default:""},forma_contagem_carga_horaria:{default:"DIA"}},this.cdRef,this.validate)}onVinculadasChange(t){this.cdRef.detectChanges()}loadData(t,e){var o=this;return(0,d.Z)(function*(){let n=Object.assign({},e.value);n=o.util.fillForm(n,t),yield Promise.all([o.unidade.loadSearch(t.unidade||t.unidade_id),o.usuario.loadSearch(t.usuario||t.usuario_id),o.programa.loadSearch(t.programa||t.programa_id),o.tipoModalidade.loadSearch(t.tipo_modalidade||t.tipo_modalidade_id)]),o.processo&&(n.id_processo=o.processo.id_processo,n.numero_processo=o.processo.numero_processo),n.data_inicio=o.auth.hora,e.patchValue(n)})()}initializeData(t){var e=this;return(0,d.Z)(function*(){e.entity=yield e.dao.getById(e.metadata.plano_trabalho.id,e.join),e.processo=e.metadata?.processo,yield e.loadData(e.entity,t)})()}saveData(t){return new Promise((e,o)=>{e(new Ua.R(Object.assign(this.form.value,{codigo_tipo_documento:this.tipoDocumento?.selectedEntity?.codigo})))})}get formaContagemCargaHoraria(){const t=this.form?.controls.forma_contagem_carga_horaria?.value||"DIA";return"DIA"==t?"day":"SEMANA"==t?"week":"mouth"}static#a=this.\u0275fac=function(e){return new(e||i)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:i,selectors:[["plano-trabalho-form-termo"]],viewQuery:function(e,o){if(1&e&&(a.Gf(D.Q,5),a.Gf(Na,5),a.Gf(Ja,5),a.Gf(Qa,5),a.Gf(Sa,5),a.Gf(Ra,5)),2&e){let n;a.iGM(n=a.CRH())&&(o.editableForm=n.first),a.iGM(n=a.CRH())&&(o.usuario=n.first),a.iGM(n=a.CRH())&&(o.unidade=n.first),a.iGM(n=a.CRH())&&(o.programa=n.first),a.iGM(n=a.CRH())&&(o.tipoDocumento=n.first),a.iGM(n=a.CRH())&&(o.tipoModalidade=n.first)}},features:[a.qOj],decls:25,vars:41,consts:[["initialFocus","programa_id",3,"form","disabled","title","submit","cancel"],["collapse","",3,"title","collapsed"],[1,"row"],["disabled","","controlName","programa_id",3,"size","dao"],["programa",""],["disabled","","controlName","usuario_id",3,"size","dao"],["usuario",""],["disabled","","controlName","unidade_id",3,"size","dao"],["unidade",""],["disabled","","controlName","tipo_modalidade_id",3,"size","dao"],["tipoModalidade",""],["numbers","","disabled","","label","% prod.","icon","bi bi-hourglass-split","controlName","ganho_produtividade",3,"size","control","labelInfo"],["label","H. Parciais","icon","bi bi-clock","controlName","tempo_proporcional","labelInfo","Total de horas menos os afastamentos.",3,"size","control"],["disabled","","label","In\xedcio","icon","bi bi-calendar-date","controlName","data_inicio","labelInfo","In\xedcio da Vig\xeancia do Programa",3,"size","control"],["disabled","","label","Final","icon","bi bi-calendar-date","controlName","data_fim","labelInfo","Final da Vig\xeancia do Programa",3,"size","control"],["disabled","","label","C. Hor\xe1ria","icon","bi bi-hourglass-split","controlName","carga_horaria",3,"size","unit","control","labelInfo"],["label","H. Totais","icon","bi bi-clock","controlName","tempo_total","labelInfo","Horas \xfateis de trabalho no per\xedodo de vig\xeancia considerando a carga hor\xe1ria, feriados e fins de semana",3,"size","control"],["disabled","","label","Data e hora","controlName","data_inicio","labelInfo","Data de cadastro do termo",3,"size","control"],["controlName","numero_processo","disabled","","labelInfo","N\xfamero do processo, com a formata\xe7\xe3o de origem",3,"label","size","control"],["controlName","tipo_documento_id","required","",3,"size","disabled","dao"],["tipoDocumento",""],["label","Vinculadas","controlName","vinculadas","labelInfo","Se inclui as atividades das unidades vinculadas a unidade do plano",3,"disabled","size","control","change"]],template:function(e,o){1&e&&(a.TgZ(0,"editable-form",0),a.NdJ("submit",function(){return o.onSaveData()})("cancel",function(){return o.onCancel()}),a.TgZ(1,"separator",1)(2,"div",2),a._UZ(3,"input-search",3,4)(5,"input-search",5,6),a.qZA(),a.TgZ(7,"div",2),a._UZ(8,"input-search",7,8)(10,"input-search",9,10)(12,"input-text",11)(13,"input-display",12),a.qZA(),a.TgZ(14,"div",2),a._UZ(15,"input-datetime",13)(16,"input-datetime",14)(17,"input-workload",15)(18,"input-display",16),a.qZA()(),a.TgZ(19,"div",2),a._UZ(20,"input-datetime",17)(21,"input-text",18)(22,"input-search",19,20),a.TgZ(24,"input-switch",21),a.NdJ("change",function(r){return o.onVinculadasChange(r)}),a.qZA()()()),2&e&&(a.Q6J("form",o.form)("disabled",o.formDisabled)("title",o.isModal?"":o.title),a.xp6(1),a.Q6J("title",o.lex.translate("Plano de trabalho"))("collapsed",!1),a.xp6(2),a.Q6J("size",6)("dao",o.programaDao),a.xp6(2),a.Q6J("size",6)("dao",o.usuarioDao),a.xp6(3),a.Q6J("size",5)("dao",o.unidadeDao),a.xp6(2),a.Q6J("size",3)("dao",o.tipoModalidadeDao),a.xp6(2),a.Q6J("size",2)("control",o.form.controls.ganho_produtividade)("labelInfo","Percentual de ganho de produtividade (Ser\xe1 descontado do "+o.lex.translate("tempo pactuado")+")"),a.uIk("maxlength",250),a.xp6(1),a.Q6J("size",2)("control",o.form.controls.tempo_proporcional),a.xp6(2),a.Q6J("size",3)("control",o.form.controls.data_inicio),a.xp6(1),a.Q6J("size",3)("control",o.form.controls.data_fim),a.xp6(1),a.Q6J("size",3)("unit",o.formaContagemCargaHoraria)("control",o.form.controls.carga_horaria)("labelInfo","Carga hor\xe1ria"+o.lex.translate("do usu\xe1rio")),a.xp6(1),a.Q6J("size",3)("control",o.form.controls.tempo_total),a.xp6(2),a.Q6J("size",3)("control",o.form.controls.data_inicio),a.xp6(1),a.Q6J("label","N\xfamero "+o.lex.translate("Processo"))("size",3)("control",o.form.controls.numero_processo),a.uIk("maxlength",250),a.xp6(1),a.Q6J("size",4)("disabled",null!=o.form.controls.numero_processo.value&&o.form.controls.numero_processo.value.length?void 0:"true")("dao",o.tipoDocumentoDao),a.xp6(2),a.Q6J("disabled",null!=o.entity&&null!=o.entity.atividades&&o.entity.atividades.length?"true":void 0)("size",2)("control",o.form.controls.vinculadas))},dependencies:[D.Q,J.a,wa.B,y.V,z.m,M.k,I.N,ca.S]})}return i})();var qa=s(2702),ua=s(6551),Q=s(684),Fa=s(9367),Va=s(9193),La=s(2866),q=s.n(La),Ga=s(3085),F=s(6384),Y=s(4978),za=s(933),Ya=s(5795),Ha=s(785),Ba=s(6601),C=s(3150),S=s(6298),ka=s(5754),Wa=s(9173),ja=s(9190),ma=s(1021),H=s(609),P=s(7224),U=s(3351),pa=s(4508),B=s(4603),E=s(5489),_a=s(4792);const Ka=["origem"],Xa=["planoEntrega"],$a=["entrega"];function at(i,l){1&i&&(a.TgZ(0,"div",21)(1,"span")(2,"strong"),a._uU(3,"Origem"),a.qZA()()())}function tt(i,l){if(1&i&&a._UZ(0,"badge",27),2&i){const t=a.oxw().row,e=a.oxw();a.Q6J("label",(null==t.plano_entrega_entrega||null==t.plano_entrega_entrega.plano_entrega||null==t.plano_entrega_entrega.plano_entrega.unidade?null:t.plano_entrega_entrega.plano_entrega.unidade.sigla)||"DESCONHECIDO")("icon",e.entityService.getIcon("Unidade"))}}function et(i,l){if(1&i&&a._UZ(0,"badge",28),2&i){const t=a.oxw().row;a.Q6J("label",t.orgao)}}function ot(i,l){if(1&i&&(a.TgZ(0,"div",22)(1,"div",23),a._UZ(2,"badge",24),a.YNc(3,tt,1,2,"badge",25),a.YNc(4,et,1,1,"badge",26),a.qZA()()),2&i){const t=l.row,e=a.oxw();a.xp6(2),a.Q6J("label",e.planoTrabalhoService.tipoEntrega(t,e.entity).titulo)("color",e.planoTrabalhoService.tipoEntrega(t,e.entity).cor),a.xp6(1),a.Q6J("ngIf",null==t.plano_entrega_entrega_id?null:t.plano_entrega_entrega_id.length),a.xp6(1),a.Q6J("ngIf",null==t.orgao?null:t.orgao.length)}}const it=function(){return["entregas.entrega:id,nome","unidade"]},nt=function(i){return["unidade_id","==",i]},ga=function(){return["status","==","ATIVO"]},lt=function(i,l){return[i,l]},rt=function(i){return[i]},st=function(i){return{unidade_id:i,status:"ATIVO"}},ha=function(i){return{filter:i}},dt=function(){return{status:"ATIVO"}};function ct(i,l){if(1&i){const t=a.EpF();a.TgZ(0,"input-search",33,34),a.NdJ("change",function(o){a.CHM(t);const n=a.oxw(2);return a.KtG(n.onPlanoEntregaChange(o))}),a.qZA()}if(2&i){a.oxw();const t=a.MAs(1),e=a.oxw();a.Q6J("placeholder","Selecione o "+e.lex.translate("Plano de entrega"))("join",a.DdM(5,it))("where","PROPRIA_UNIDADE"==(null==t?null:t.value)?a.WLB(9,lt,a.VKq(6,nt,null==e.entity?null:e.entity.unidade_id),a.DdM(8,ga)):a.VKq(13,rt,a.DdM(12,ga)))("selectParams","PROPRIA_UNIDADE"==(null==t?null:t.value)?a.VKq(17,ha,a.VKq(15,st,null==e.entity?null:e.entity.unidade_id)):a.VKq(20,ha,a.DdM(19,dt)))("dao",e.planoEntregaDao)}}function ut(i,l){1&i&&a._UZ(0,"input-text",35,36),2&i&&a.uIk("maxlength",250)}const k=function(){return["PROPRIA_UNIDADE","OUTRA_UNIDADE"]};function mt(i,l){if(1&i){const t=a.EpF();a.TgZ(0,"input-select",29,30),a.NdJ("change",function(){const n=a.CHM(t).row,r=a.oxw();return a.KtG(r.onOrigemChange(n))}),a.qZA(),a.YNc(2,ct,2,22,"input-search",31),a.YNc(3,ut,2,1,"input-text",32)}if(2&i){const t=a.MAs(1),e=a.oxw();a.Q6J("control",e.form.controls.origem)("items",e.lookup.ORIGENS_ENTREGAS_PLANO_TRABALHO),a.xp6(2),a.Q6J("ngIf",a.DdM(4,k).includes(null==t?null:t.value)),a.xp6(1),a.Q6J("ngIf","OUTRO_ORGAO"==(null==t?null:t.value))}}function pt(i,l){1&i&&(a.TgZ(0,"span")(1,"strong"),a._uU(2,"Entrega"),a.qZA()())}function _t(i,l){if(1&i&&(a.TgZ(0,"div",39),a._UZ(1,"badge",40)(2,"badge",41),a.qZA()),2&i){const t=a.oxw().row,e=a.oxw();a.xp6(1),a.Q6J("label",e.util.getDateFormatted(null==t.plano_entrega_entrega?null:t.plano_entrega_entrega.data_inicio)),a.xp6(1),a.Q6J("label",e.util.getDateFormatted(null==t.plano_entrega_entrega?null:t.plano_entrega_entrega.data_fim))}}function gt(i,l){if(1&i&&(a.TgZ(0,"small"),a._uU(1),a.qZA(),a.YNc(2,_t,3,2,"div",37),a._UZ(3,"reaction",38)),2&i){const t=l.row,e=a.oxw();a.xp6(1),a.Oqu(e.planoTrabalhoService.tipoEntrega(t,e.entity).descricao),a.xp6(1),a.Q6J("ngIf",a.DdM(3,k).includes(e.planoTrabalhoService.tipoEntrega(t,e.entity).tipo)),a.xp6(1),a.Q6J("entity",t)}}function ht(i,l){if(1&i){const t=a.EpF();a.TgZ(0,"input-select",43,44),a.NdJ("change",function(o){a.CHM(t);const n=a.oxw(2);return a.KtG(n.onEntregaChange(o))}),a.qZA()}if(2&i){const t=a.oxw(2);a.Q6J("control",t.form.controls.plano_entrega_entrega_id)("items",t.entregas)}}function ft(i,l){if(1&i&&(a.TgZ(0,"div",39),a._UZ(1,"badge",40)(2,"badge",41),a.qZA()),2&i){const t=a.oxw(2);a.xp6(1),a.Q6J("label",t.util.getDateFormatted(t.entrega.selectedItem.data.data_inicio)),a.xp6(1),a.Q6J("label",t.util.getDateFormatted(t.entrega.selectedItem.data.data_fim))}}function bt(i,l){if(1&i&&(a.YNc(0,ht,2,2,"input-select",42),a.YNc(1,ft,3,2,"div",37)),2&i){const t=a.oxw();a.Q6J("ngIf",a.DdM(2,k).includes(null==t.origem?null:t.origem.value)),a.xp6(1),a.Q6J("ngIf",null==t.entrega?null:t.entrega.selectedItem)}}function vt(i,l){if(1&i&&(a.TgZ(0,"div")(1,"small"),a._UZ(2,"badge",47),a.qZA(),a.TgZ(3,"small"),a._UZ(4,"badge",48),a.qZA()()),2&i){const t=a.oxw(2);a.xp6(2),a.Q6J("color","warning")("label",t.totalForcaTrabalho+"%"),a.xp6(2),a.Q6J("color","secondary")("label",t.totalForcaTrabalho-100+"%")}}function Tt(i,l){if(1&i&&(a.TgZ(0,"small"),a._UZ(1,"badge",47),a.qZA()),2&i){const t=a.oxw(2);a.xp6(1),a.Q6J("color",100==t.totalForcaTrabalho?"success":"warning")("label",t.totalForcaTrabalho+"%")}}function Ct(i,l){if(1&i&&(a.TgZ(0,"div",21),a.YNc(1,vt,5,4,"div",45),a.YNc(2,Tt,2,2,"ng-template",null,46,a.W1O),a.qZA()),2&i){const t=a.MAs(3),e=a.oxw();a.xp6(1),a.Q6J("ngIf",e.totalForcaTrabalho>100)("ngIfElse",t)}}function At(i,l){if(1&i&&(a.TgZ(0,"small"),a._uU(1),a.qZA()),2&i){const t=l.row;a.xp6(1),a.Oqu(t.forca_trabalho+"%")}}function yt(i,l){if(1&i){const t=a.EpF();a.TgZ(0,"input-text",49),a.NdJ("change",function(){const n=a.CHM(t).row,r=a.oxw();return a.KtG(r.onForcaTrabalhoChange(n))}),a.qZA()}if(2&i){const t=a.oxw();a.Q6J("control",t.form.controls.forca_trabalho),a.uIk("maxlength",250)}}function xt(i,l){1&i&&(a.TgZ(0,"div",21)(1,"span")(2,"strong"),a._uU(3,"Descri\xe7\xe3o dos Trabalhos"),a.qZA()()())}function Et(i,l){if(1&i&&(a.TgZ(0,"div")(1,"small"),a._uU(2),a.qZA()()),2&i){const t=a.oxw().row;a.xp6(2),a.Oqu(t.descricao)}}function Zt(i,l){if(1&i&&a.YNc(0,Et,3,1,"div",45),2&i){const t=l.row,e=a.oxw(),o=a.MAs(30);a.Q6J("ngIf",t.descricao!=e.planoTrabalhoService.tipoEntrega(t,e.entity).descricao)("ngIfElse",o)}}function Dt(i,l){1&i&&(a.TgZ(0,"small"),a._uU(1,"Detalhe/Descreva os trabalhos"),a.qZA())}function Ot(i,l){if(1&i&&a._UZ(0,"input-textarea",50),2&i){const t=a.oxw();a.Q6J("rows",2)("control",t.form.controls.descricao)}}let W=(()=>{class i extends S.D{set control(t){super.control=t}get control(){return super.control}set entity(t){super.entity=t}get entity(){return super.entity}set disabled(t){this._disabled!=t&&(this._disabled=t)}get disabled(){return this._disabled}set noPersist(t){super.noPersist=t}get noPersist(){return super.noPersist}set planoTrabalhoEditavel(t){this._planoTrabalhoEditavel!=t&&(this._planoTrabalhoEditavel=t)}get planoTrabalhoEditavel(){return this._planoTrabalhoEditavel}get items(){return this.gridControl.value||this.gridControl.setValue(new O.p),this.gridControl.value.entregas||(this.gridControl.value.entregas=[]),this.gridControl.value.entregas}constructor(t){super(t),this.injector=t,this.atualizaPlanoTrabalhoEvent=new a.vpe,this.options=[],this.totalForcaTrabalho=0,this.entregas=[],this._disabled=!1,this._planoTrabalhoEditavel=!0,this.validate=(e,o)=>{let n=null;return["forca_trabalho"].indexOf(o)>=0&&1==e.value||(["forca_trabalho"].indexOf(o)>=0&&!e.value&&(n="Obrigat\xf3rio!"),["descricao"].indexOf(o)>=0&&!e.value?.length&&(n="Obrigat\xf3rio!"),["forca_trabalho"].indexOf(o)>=0&&(e.value<1||e.value>100)&&(n="Deve estar entre 1 e 100"),["plano_entrega_entrega_id"].indexOf(o)>=0&&(["PROPRIA_UNIDADE","OUTRA_UNIDADE"].includes(this.form?.controls.origem.value)&&!e.value&&(n="Obrigat\xf3rio!"),this.entity?.entregas?.filter(r=>!!r.plano_entrega_entrega_id&&r.id!=this.grid?.editing?.id).find(r=>r.plano_entrega_entrega_id==e.value)&&(n="Esta entrega est\xe1 em duplicidade!"))),n},this.dao=t.get(Wa.w),this.cdRef=t.get(a.sBO),this.planoTrabalhoDao=t.get(w.t),this.planoEntregaDao=t.get(ja.r),this.planoTrabalhoService=t.get(Q.p),this.peeDao=t.get(ma.K),this.unidadeService=t.get(H.Z),this.join=["entrega","plano_entrega_entrega.entrega","plano_entrega_entrega.plano_entrega:id,unidade_id","plano_entrega_entrega.plano_entrega.unidade:id,sigla"],this.form=this.fh.FormBuilder({origem:{default:null},orgao:{default:null},descricao:{default:""},forca_trabalho:{default:1},plano_trabalho_id:{default:null},plano_entrega_id:{default:null},plano_entrega_entrega_id:{default:null}},this.cdRef,this.validate)}validateEntregas(){let t={start:this.entity.data_inicio,end:this.entity.data_fim};for(let e of this.items){let o=e.plano_entrega_entrega;if(o&&(!(o.data_fim?o.data_fim:o.data_inicio.getTime()<=this.entity.data_fim.getTime()?this.entity.data_fim:void 0)||!this.util.intersection([{start:o.data_inicio,end:o.data_fim||o.data_inicio},t])))return this.lex.translate("Entrega")+" "+o.descricao+" possui datas incompat\xedveis (in\xedcio "+this.util.getDateFormatted(o.data_inicio)+(o.data_fim?"e fim "+this.util.getDateFormatted(o.data_fim):"")+")"}}ngOnInit(){var t=()=>super.ngOnInit,e=this;return(0,d.Z)(function*(){t().call(e),e.entity=e.metadata?.entity||e.entity,e.totalForcaTrabalho=Math.round(100*e.somaForcaTrabalho(e.entity?.entregas))/100,e.entity._metadata=e.entity._metadata||{},e.entity._metadata.novaEntrega=void 0})()}addEntrega(){var t=this;return(0,d.Z)(function*(){return Object.assign(new ka.U,{_status:"ADD",id:t.dao.generateUuid(),plano_trabalho_id:t.entity?.id})})()}loadEntrega(t,e){var o=this;return(0,d.Z)(function*(){let n=e;if(t.controls.descricao.setValue(e.descricao),t.controls.forca_trabalho.setValue(e.forca_trabalho),t.controls.plano_trabalho_id.setValue(e.plano_trabalho_id),t.controls.orgao.setValue(null),t.controls.plano_entrega_entrega_id.setValue(null),e.plano_entrega_entrega&&(t.controls.plano_entrega_id.setValue(e.plano_entrega_entrega.plano_entrega.id),t.controls.plano_entrega_entrega_id.setValue(e.plano_entrega_entrega_id)),"ADD"!=n._status||t.controls.plano_entrega_id.value)n.plano_entrega_entrega?.plano_entrega?.unidade_id==o.entity.unidade_id?(t.controls.origem.setValue("PROPRIA_UNIDADE"),yield o.carregarEntregas(n.plano_entrega_entrega.plano_entrega_id),t.controls.plano_entrega_entrega_id.setValue(n.plano_entrega_entrega_id)):n.plano_entrega_entrega?(t.controls.origem.setValue("OUTRA_UNIDADE"),yield o.carregarEntregas(n.plano_entrega_entrega.plano_entrega_id),t.controls.plano_entrega_entrega_id.setValue(n.plano_entrega_entrega_id)):n.orgao?.length?(t.controls.origem.setValue("OUTRO_ORGAO"),t.controls.orgao.setValue(n.orgao)):t.controls.origem.setValue("SEM_ENTREGA");else{t.controls.origem.setValue("PROPRIA_UNIDADE");let r=yield o.planoEntregaDao.query({where:[["unidade_id","==",o.entity.unidade_id],["status","==","ATIVO"]]}).asPromise();t.controls.plano_entrega_id.setValue(r[0].id)}})()}removeEntrega(t){var e=this;return(0,d.Z)(function*(){if(yield e.dialog.confirm("Exclui ?","Deseja realmente excluir?")){e.loading=!0;try{e.isNoPersist?Object.assign(t,{_status:"DELETE"}):yield e.dao?.delete(t.id)}finally{e.loading=!1,e.atualizaPlanoTrabalhoEvent.emit(e.entity.id)}return e.totalForcaTrabalho=Math.round(100*(e.totalForcaTrabalho-1*t.forca_trabalho))/100,!e.isNoPersist}return!1})()}saveEntrega(t,e){var o=this;return(0,d.Z)(function*(){o.entity._metadata=o.entity._metadata||{},o.entity._metadata.novaEntrega=e,o.entity._metadata.novaEntrega.plano_entrega_entrega_id=o.form?.controls.plano_entrega_entrega_id.value,o.entity._metadata.novaEntrega.orgao=o.form?.controls.orgao.value,o.entity._metadata.novaEntrega.descricao=o.form?.controls.descricao.value,o.entity._metadata.novaEntrega.forca_trabalho=o.form?.controls.forca_trabalho.value,o.loading=!0;try{o.isNoPersist||(yield o.dao.save(o.entity._metadata.novaEntrega,o.join))}catch(n){o.error(n.message?n.message:n.toString()||n)}finally{e.forca_trabalho=1*o.form?.controls.forca_trabalho.value,e.plano_entrega_entrega=o.entrega?.selectedItem?.data||null,o.totalForcaTrabalho=Math.round(100*o.somaForcaTrabalho(o.entity?.entregas))/100,o.loading=!1}return o.entity._metadata.novaEntrega})()}saveEndEntrega(t){this.entity._metadata=null,this.atualizaPlanoTrabalhoEvent.emit(this.entity.id)}somaForcaTrabalho(t=[]){return t.map(e=>1*e.forca_trabalho).reduce((e,o)=>e+o,0)}carregarEntregas(t){var e=this;return(0,d.Z)(function*(){let o="string"==typeof t?yield e.planoEntregaDao.getById(t,["entregas.entrega:id,nome","unidade"]):t,n={id:o?.id,unidade_id:o?.unidade_id,unidade:o?.unidade};e.entregas=o?.entregas.map(r=>Object.assign({},{key:r.id,value:r.descricao||r.entrega?.nome||"Desconhecido",data:Object.assign(r,{plano_entrega:n})}))||[],e.entregas.sort((r,m)=>r.value>m.value?1:-1),e.entregas.find(r=>r.key==e.form.controls.plano_entrega_entrega_id.value)||e.form.controls.plano_entrega_entrega_id.setValue(null)})()}onOrigemChange(t){var e=this;return(0,d.Z)(function*(){let o=e.form.controls.origem.value;e.cdRef.detectChanges(),"OUTRO_ORGAO"==o?e.form?.controls.plano_entrega_entrega_id.setValue(null):"SEM_ENTREGA"==o?(e.form?.controls.orgao.setValue(null),e.form?.controls.plano_entrega_entrega_id.setValue(null)):"OUTRA_UNIDADE"==o&&(e.form?.controls.orgao.setValue(null),e.form?.controls.plano_entrega_id.value||(e.loading=!0,e.planoEntrega?.onSelectClick(new Event("SELECT")),e.loading=!1))})()}onPlanoEntregaChange(t){let e=this.planoEntrega?.selectedEntity;this.carregarEntregas(e)}onEntregaChange(t){}onForcaTrabalhoChange(t){let e=this.items.findIndex(o=>o.id==t.id);this.totalForcaTrabalho=Math.round(100*(this.somaForcaTrabalho(this.grid?.items)-1*this.items[e].forca_trabalho+1*this.form?.controls.forca_trabalho.value))/100}static#a=this.\u0275fac=function(e){return new(e||i)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:i,selectors:[["plano-trabalho-list-entrega"]],viewQuery:function(e,o){if(1&e&&(a.Gf(D.Q,5),a.Gf(C.M,5),a.Gf(Ka,5),a.Gf(Xa,5),a.Gf($a,5)),2&e){let n;a.iGM(n=a.CRH())&&(o.editableForm=n.first),a.iGM(n=a.CRH())&&(o.grid=n.first),a.iGM(n=a.CRH())&&(o.origem=n.first),a.iGM(n=a.CRH())&&(o.planoEntrega=n.first),a.iGM(n=a.CRH())&&(o.entrega=n.first)}},inputs:{control:"control",entity:"entity",disabled:"disabled",noPersist:"noPersist",cdRef:"cdRef",planoTrabalhoEditavel:"planoTrabalhoEditavel"},outputs:{atualizaPlanoTrabalhoEvent:"atualizaPlanoTrabalhoEvent"},features:[a.qOj],decls:34,vars:39,consts:[["noMargin","","editable","",3,"items","form","selectable","minHeight","join","groupBy","add","remove","save","load","saveEnd","hasDelete","hasEdit","hasAdd"],["gridEntregas",""],[3,"titleTemplate","template","editTemplate","verticalAlign","width","align"],["titleOrigem",""],["columnOrigem",""],["editOrigem",""],[3,"width","titleTemplate","template","editTemplate","verticalAlign"],["class","text-center"],["titleEntrega",""],["columnEntrega",""],["editEntrega",""],[3,"titleTemplate","title","template","editTemplate","width","align","titleHint"],["titleForcaTrabalho",""],["columnForcaTrabalho",""],["editForcaTrabalho",""],[3,"minWidth","maxWidth","titleTemplate","template","editTemplate","verticalAlign","align"],["titleDescricao",""],["columnDescricao",""],["solicitarDescricao",""],["editDescricao",""],["type","options"],[1,"text-center"],[1,"w-100","d-flex","justify-content-center"],[1,"one-per-line"],[3,"label","color"],["color","primary",3,"label","icon",4,"ngIf"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label",4,"ngIf"],["color","primary",3,"label","icon"],["icon","bi bi-box-arrow-down-left","color","warning",3,"label"],["controlName","origem","controlName","origem",3,"control","items","change"],["origem",""],["label","","controlName","plano_entrega_id",3,"placeholder","join","where","selectParams","dao","change",4,"ngIf"],["controlName","orgao","placeholder","\xd3rg\xe3o",4,"ngIf"],["label","","controlName","plano_entrega_id",3,"placeholder","join","where","selectParams","dao","change"],["planoEntrega",""],["controlName","orgao","placeholder","\xd3rg\xe3o"],["orgao",""],["class","w-100",4,"ngIf"],["origem","PLANO_TRABALHO_ENTREGA",3,"entity"],[1,"w-100"],["color","light","icon","bi bi-box-arrow-in-right","hint","Data de in\xedcio",3,"label"],["color","light","icon","bi bi-box-arrow-right","hint","Data de t\xe9rmino",3,"label"],["nullable","","itemNull","- Selecione -","controlName","plano_entrega_entrega_id",3,"control","items","change",4,"ngIf"],["nullable","","itemNull","- Selecione -","controlName","plano_entrega_entrega_id",3,"control","items","change"],["entrega",""],[4,"ngIf","ngIfElse"],["umCHD",""],["icon","bi bi-calculator",3,"color","label"],["icon","bi bi-intersect",3,"color","label"],["number","","sufix","%","controlName","forca_trabalho",3,"control","change"],["controlName","descricao",3,"rows","control"]],template:function(e,o){if(1&e&&(a.TgZ(0,"grid",0,1)(2,"columns")(3,"column",2),a.YNc(4,at,4,0,"ng-template",null,3,a.W1O),a.YNc(6,ot,5,4,"ng-template",null,4,a.W1O),a.YNc(8,mt,4,5,"ng-template",null,5,a.W1O),a.qZA(),a.TgZ(10,"column",6),a.YNc(11,pt,3,0,"ng-template",7,8,a.W1O),a.YNc(13,gt,4,4,"ng-template",null,9,a.W1O),a.YNc(15,bt,2,3,"ng-template",null,10,a.W1O),a.qZA(),a.TgZ(17,"column",11),a.YNc(18,Ct,4,2,"ng-template",null,12,a.W1O),a.YNc(20,At,2,1,"ng-template",null,13,a.W1O),a.YNc(22,yt,1,2,"ng-template",null,14,a.W1O),a.qZA(),a.TgZ(24,"column",15),a.YNc(25,xt,4,0,"ng-template",null,16,a.W1O),a.YNc(27,Zt,1,2,"ng-template",null,17,a.W1O),a.YNc(29,Dt,2,0,"ng-template",null,18,a.W1O),a.YNc(31,Ot,1,2,"ng-template",null,19,a.W1O),a.qZA(),a._UZ(33,"column",20),a.qZA()()),2&e){const n=a.MAs(5),r=a.MAs(7),m=a.MAs(9),p=a.MAs(12),_=a.MAs(14),c=a.MAs(16),f=a.MAs(19),u=a.MAs(21),A=a.MAs(23),Z=a.MAs(26),R=a.MAs(28),x=a.MAs(32);a.Q6J("items",o.items)("form",o.form)("selectable",!1)("minHeight",o.items.length>2?0:300)("join",o.join)("groupBy",o.groupBy)("add",o.addEntrega.bind(o))("remove",o.removeEntrega.bind(o))("save",o.saveEntrega.bind(o))("load",o.loadEntrega.bind(o))("saveEnd",o.saveEndEntrega.bind(o))("hasDelete",!o.disabled&&o.planoTrabalhoEditavel)("hasEdit",!o.disabled&&o.planoTrabalhoEditavel)("hasAdd",!o.disabled&&o.planoTrabalhoEditavel),a.xp6(3),a.Q6J("titleTemplate",n)("template",r)("editTemplate",m)("verticalAlign","middle")("width",300)("align","center"),a.xp6(7),a.Q6J("width",350)("titleTemplate",p)("template",_)("editTemplate",c)("verticalAlign","middle"),a.xp6(7),a.Q6J("titleTemplate",f)("title","% CHD")("template",u)("editTemplate",A)("width",100)("align","center")("titleHint","% Carga Hor\xe1ria Dispon\xedvel"),a.xp6(7),a.Q6J("minWidth",150)("maxWidth",250)("titleTemplate",Z)("template",R)("editTemplate",x)("verticalAlign","middle")("align","center")}},dependencies:[h.O5,C.M,P.a,U.b,y.V,z.m,pa.Q,B.p,E.F,_a.C]})}return i})();const It=["gridAtividades"],Pt=["gridDocumentos"],Ut=["tabs"],wt=["usuario"],Nt=["programa"],Jt=["unidade"],Qt=["tipoModalidade"],St=["planoEntrega"],Rt=["atividade"],Mt=["entrega"],qt=["documentos"];function Ft(i,l){if(1&i&&(a.TgZ(0,"separator",26),a._UZ(1,"calendar-efemerides",27),a.qZA()),2&i){const t=a.oxw(2);a.xp6(1),a.Q6J("efemerides",t.horasTotais)("partial",!1)}}function Vt(i,l){if(1&i&&(a.TgZ(0,"separator",28),a._UZ(1,"calendar-efemerides",29),a.qZA()),2&i){const t=a.oxw(2);a.xp6(1),a.Q6J("efemerides",t.horasParciais)}}function Lt(i,l){if(1&i){const t=a.EpF();a.ynx(0),a.TgZ(1,"div",4)(2,"input-workload",21),a.NdJ("change",function(o){a.CHM(t);const n=a.oxw();return a.KtG(n.onCargaHorariaChenge(o))}),a.qZA(),a._UZ(3,"input-timer",22)(4,"input-timer",23),a.qZA(),a.YNc(5,Ft,2,2,"separator",24),a.YNc(6,Vt,2,1,"separator",25),a.BQk()}if(2&i){const t=a.oxw();a.xp6(2),a.Q6J("size",4)("unit",t.formaContagemCargaHoraria)("control",t.form.controls.carga_horaria)("unitChange",t.onFormaContagemCargaHorariaChange.bind(t)),a.xp6(1),a.Q6J("size",4)("control",t.form.controls.tempo_total),a.xp6(1),a.Q6J("size",4)("control",t.form.controls.tempo_proporcional),a.xp6(1),a.Q6J("ngIf",t.horasTotais),a.xp6(1),a.Q6J("ngIf",t.horasParciais)}}function Gt(i,l){if(1&i&&a._UZ(0,"top-alert",30),2&i){const t=a.oxw();a.Q6J("message","Antes de incluir "+t.lex.translate("entrega")+" neste "+t.lex.translate("Plano de Trabalho")+", \xe9 necess\xe1rio selecionar "+t.lex.translate("a Unidade")+" e  o "+t.lex.translate("Programa")+"!")}}function zt(i,l){if(1&i&&(a.TgZ(0,"div"),a._UZ(1,"plano-trabalho-list-entrega",31),a.qZA()),2&i){const t=a.oxw();a.xp6(1),a.Q6J("disabled",t.formDisabled)("entity",t.entity)}}function Yt(i,l){if(1&i&&(a.TgZ(0,"tab",32)(1,"separator",17),a._UZ(2,"input-switch",33)(3,"input-editor",34),a.qZA(),a.TgZ(4,"separator",35),a._UZ(5,"input-switch",36)(6,"input-editor",37),a.qZA()()),2&i){const t=a.oxw();a.Q6J("label",t.lex.translate("Texto Complementar")),a.xp6(1),a.Q6J("title","Texto complementar da "+t.lex.translate("unidade")),a.xp6(1),a.Q6J("disabled",t.podeEditarTextoComplementar(t.form.controls.unidade_id.value))("size",12)("label","Editar texto complementar "+t.lex.translate("na unidade")),a.xp6(1),a.Q6J("disabled",t.form.controls.editar_texto_complementar_unidade.value?void 0:"true")("dataset",t.planoDataset),a.xp6(2),a.Q6J("disabled",t.podeEditarTextoComplementar(t.form.controls.unidade_id.value))("size",12)("label","Editar texto complementar "+t.lex.translate("do usu\xe1rio")),a.xp6(1),a.Q6J("disabled",t.form.controls.editar_texto_complementar_usuario.value?void 0:"true")("dataset",t.planoDataset)}}function Ht(i,l){if(1&i&&(a.TgZ(0,"tab",38)(1,"div",39),a._UZ(2,"documentos",40,41),a.qZA()()),2&i){const t=a.oxw(),e=a.MAs(12);a.Q6J("label",t.lex.translate("Termo")),a.xp6(2),a.Q6J("entity",t.entity)("disabled",t.formDisabled)("cdRef",t.cdRef)("needSign",t.planoTrabalhoService.needSign)("extraTags",t.planoTrabalhoService.extraTags)("editingId",t.formDisabled?void 0:t.editingId)("datasource",t.datasource)("template",null==e||null==e.selectedEntity?null:e.selectedEntity.template_tcr)}}const Bt=function(){return["afastamentos","lotacao","unidades","participacoes_programas"]},kt=function(){return["usuario_id"]},Wt=function(){return["usuario_id","programa_id","tipo_modalidade_id"]};let j=(()=>{class i extends da.F{constructor(t){super(t,O.p,w.t),this.injector=t,this.entregas=[],this.gestoresUnidadeExecutora=[],this.validate=(e,o)=>{let n=null;return["unidade_id","programa_id","usuario_id","tipo_modalidade_id"].indexOf(o)>=0&&!e.value?.length?n="Obrigat\xf3rio":["carga_horaria"].indexOf(o)>=0&&!e.value?n="Valor n\xe3o pode ser zero.":["data_inicio","data_fim"].includes(o)&&!this.util.isDataValid(e.value)?n="Inv\xe1lido":"data_fim"==o&&this.util.isDataValid(this.form?.controls.data_inicio.value)&&this.util.asTimestamp(e.value)<=this.util.asTimestamp(this.form.controls.data_inicio.value)?n="Menor que o in\xedcio":this.programa&&"data_inicio"==o&&q()(e.value).startOf("day")<q()(this.programa.selectedEntity?.data_inicio).startOf("day")?n="Menor que programa":this.programa&&"data_fim"==o&&q()(e.value).startOf("day")>q()(this.programa.selectedEntity?.data_fim).startOf("day")&&(n="Maior que programa"),n},this.formValidation=function(){var e=(0,d.Z)(function*(o){return""});return function(o){return e.apply(this,arguments)}}(),this.titleEdit=e=>"Editando "+this.lex.translate("Plano de Trabalho")+": "+(e?.usuario?.apelido||""),this.join=["unidade.entidade","entregas.entrega","entregas.plano_entrega_entrega:id,plano_entrega_id","usuario","programa.template_tcr","tipo_modalidade","documento","documentos.assinaturas.usuario:id,nome,apelido","entregas.plano_entrega_entrega.entrega","entregas.plano_entrega_entrega.plano_entrega.unidade:id,nome,sigla","entregas.reacoes.usuario:id,nome,apelido"],this.joinPrograma=["template_tcr"],this.programaDao=t.get(la.w),this.usuarioDao=t.get(G.q),this.unidadeDao=t.get(N.J),this.documentoService=t.get(qa.t),this.templateService=t.get(Fa.E),this.utilService=t.get(Va.f),this.calendar=t.get(ua.o),this.allPages=t.get(sa.T),this.tipoModalidadeDao=t.get(ra.D),this.documentoDao=t.get(na.d),this.planoTrabalhoService=t.get(Q.p),this.modalWidth=1300,this.planoDataset=this.dao.dataset(),this.form=this.fh.FormBuilder({carga_horaria:{default:""},tempo_total:{default:""},tempo_proporcional:{default:""},data_inicio:{default:new Date},data_fim:{default:new Date},usuario_id:{default:""},unidade_id:{default:""},programa_id:{default:""},documento_id:{default:null},documentos:{default:[]},atividades:{default:[]},entregas:{default:[]},tipo_modalidade_id:{default:""},forma_contagem_carga_horaria:{default:"DIA"},editar_texto_complementar_unidade:{default:!1},editar_texto_complementar_usuario:{default:!1},unidade_texto_complementar:{default:""},usuario_texto_complementar:{default:""},criterios_avaliacao:{default:[]},criterio_avaliacao:{default:""}},this.cdRef,this.validate),this.programaMetadata={todosUnidadeExecutora:!0,vigentesUnidadeExecutora:!1}}ngOnInit(){super.ngOnInit();const t=(this.url?this.url[this.url.length-1]?.path:"")||"";this.action=["termos"].includes(t)?t:this.action,this.buscaGestoresUnidadeExecutora(this.entity?.unidade??null)}atualizarTcr(){this.entity=this.loadEntity();let o=this.planoTrabalhoService.atualizarTcr(this.planoTrabalho,this.entity,this.form.controls.usuario_texto_complementar.value,this.form.controls.unidade_texto_complementar.value);this.form?.controls.documento_id.setValue(o?.id),this.form?.controls.documentos.setValue(this.entity.documentos),this.datasource=o?.datasource||{},this.template=this.entity.programa?.template_tcr,this.editingId=["ADD","EDIT"].includes(o?._status||"")?o.id:void 0,this.cdRef.detectChanges()}get isTermos(){return"termos"==this.action}onUnidadeSelect(t){let e=this.unidade?.selectedEntity;this.entity.unidade=e,this.entity.unidade_id=e.id,this.form.controls.forma_contagem_carga_horaria.setValue(e?.entidade?.forma_contagem_carga_horaria||"DIA"),this.form.controls.unidade_texto_complementar.setValue(e?.texto_complementar_plano||""),this.unidadeDao.getById(e.id,["gestor:id,usuario_id","gestores_substitutos:id,usuario_id","gestores_delegados:id,usuario_id"]).then(o=>{this.buscaGestoresUnidadeExecutora(o)})}podeEditarTextoComplementar(t){return t==this.auth.unidadeGestor()?.id?void 0:"true"}onProgramaSelect(t){let e=t.entity;this.entity.programa_id=e.id,this.entity.programa=e,this.form?.controls.criterios_avaliacao.setValue(e.plano_trabalho_criterios_avaliacao||[]),this.form?.controls.data_inicio.updateValueAndValidity(),this.form?.controls.data_fim.updateValueAndValidity(),this.calculaTempos(),this.cdRef.detectChanges()}onUsuarioSelect(t){var e=this;this.form.controls.usuario_texto_complementar.setValue(t.entity?.texto_complementar_plano||""),this.form?.controls.unidade_id.value||t.entity.unidades?.every(function(){var o=(0,d.Z)(function*(n){if(t.entity.lotacao.unidade_id==n.id){if(!e.form?.controls.programa_id.value){n.path.split("/").reverse();let p=0,_=0;for(;0==p;)yield e.programaDao.query({where:[["vigentesUnidadeExecutora","==",e.auth.unidade.id]]}).asPromise().then(c=>{c.length>0&&0==p&&(p=1,e.preencheUnidade(n),e.preenchePrograma(c[0]))}),_+=1}return!1}return!0});return function(n){return o.apply(this,arguments)}}()),this.calculaTempos(),this.cdRef.detectChanges()}preencheUnidade(t){this.form?.controls.unidade_id.setValue(t.id),this.entity.unidade=t,this.entity.unidade_id=t.id,this.form.controls.forma_contagem_carga_horaria.setValue(t?.entidade?.forma_contagem_carga_horaria||"DIA"),this.form.controls.unidade_texto_complementar.setValue(t?.texto_complementar_plano||""),this.unidadeDao.getById(t.id,["gestor:id,usuario_id","gestores_substitutos:id,usuario_id","gestores_delegados:id,usuario_id"]).then(e=>{this.buscaGestoresUnidadeExecutora(e)})}preenchePrograma(t){t?(this.form?.controls.programa_id.setValue(t.id),this.entity.programa_id=t.id,this.entity.programa=t,this.form?.controls.criterios_avaliacao.setValue(t.plano_trabalho_criterios_avaliacao||[]),this.form?.controls.data_inicio.updateValueAndValidity(),this.form?.controls.data_fim.updateValueAndValidity()):this.form?.setErrors({programa:"N\xe3o h\xe1 programa vigente para a unidade executora."})}onDataInicioChange(t){this.calculaTempos()}onDataFimChange(t){this.calculaTempos()}onCargaHorariaChenge(t){this.calculaTempos()}calculaTempos(){const t=this.form?.controls.data_inicio.value,e=this.form?.controls.data_fim.value,o=this.form?.controls.carga_horaria.value||8,n=this.usuario?.selectedEntity,r=this.unidade?.selectedEntity;n&&r&&this.util.isDataValid(t)&&this.util.isDataValid(e)&&this.util.asTimestamp(t)<this.util.asTimestamp(e)&&this.calendar.loadFeriadosCadastrados(r.id).then(m=>{this.horasTotais=this.calendar.calculaDataTempoUnidade(t,e,o,r,"ENTREGA",[],[]),this.horasParciais=this.calendar.calculaDataTempoUnidade(t,e,o,r,"ENTREGA",[],n.afastamentos),this.form?.controls.tempo_total.setValue(this.horasTotais.tempoUtil),this.form?.controls.tempo_proporcional.setValue(this.horasParciais.tempoUtil)})}loadData(t,e){var o=this;return(0,d.Z)(function*(){o.planoTrabalho=new O.p(t),yield Promise.all([o.calendar.loadFeriadosCadastrados(t.unidade_id),o.usuario?.loadSearch(t.usuario||t.usuario_id),o.unidade?.loadSearch(t.unidade||t.unidade_id),o.programa?.loadSearch(t.programa||t.programa_id),o.tipoModalidade?.loadSearch(t.tipo_modalidade||t.tipo_modalidade_id)]);let n=Object.assign({},e.value);e.patchValue(o.util.fillForm(n,t)),o.calculaTempos(),o.atualizarTcr()})()}initializeData(t){var e=this;return(0,d.Z)(function*(){if(e.isTermos)e.entity=yield e.dao.getById(e.urlParams.get("id"),e.join);else{e.entity=new O.p,e.entity.carga_horaria=e.auth.entidade?.carga_horaria_padrao||8,e.entity.forma_contagem_carga_horaria=e.auth.entidade?.forma_contagem_carga_horaria||"DIA",e.entity.unidade_id=e.auth.unidade.id;let n=yield e.programaDao.query({where:[["vigentesUnidadeExecutora","==",e.auth.unidade.id]],join:e.joinPrograma}).asPromise();e.preenchePrograma(n[n.length-1]),e.buscaGestoresUnidadeExecutora(e.auth.unidade),e.gestoresUnidadeExecutora.includes(e.auth.unidade.id)||(e.entity.usuario_id=e.auth.usuario.id)}yield e.loadData(e.entity,e.form);let o=new Date;o.setHours(0,0,0,0),e.form?.controls.data_inicio.setValue(o),e.form?.controls.data_fim.setValue("")})()}loadEntity(){let t=this.util.fill(new O.p,this.entity);return t=this.util.fillForm(t,this.form.value),t.usuario=this.usuario.selectedEntity||this.entity?.usuario,t.unidade=this.unidade?.selectedEntity||this.entity?.unidade,t.programa=this.programa?.selectedEntity||this.entity?.programa,t.tipo_modalidade=this.tipoModalidade.selectedEntity||this.entity?.tipo_modalidade,t}saveData(t){var e=this;return(0,d.Z)(function*(){e.submitting=!0;try{e.atualizarTcr(),e.documentos?.saveData(),e.submitting=!0,e.entity.documentos=e.entity.documentos.filter(r=>["ADD","EDIT","DELETE"].includes(r._status||""));let o=[e.dao.save(e.entity,e.join)];e.form.controls.editar_texto_complementar_unidade.value&&o.push(e.unidadeDao.update(e.entity.unidade_id,{texto_complementar_plano:e.form.controls.unidade_texto_complementar.value})),e.form.controls.editar_texto_complementar_usuario.value&&o.push(e.usuarioDao.update(e.entity.usuario_id,{texto_complementar_plano:e.form.controls.usuario_texto_complementar.value}));let n=yield Promise.all(o);e.entity=n[0]}finally{e.submitting=!1}return!0})()}onTabSelect(t){"TERMO"==t.key&&this.atualizarTcr()}documentoDynamicButtons(t){let e=[];return this.isTermos&&this.planoTrabalhoService.needSign(this.entity,t)&&e.push({hint:"Assinar",icon:"bi bi-pen",onClick:this.signDocumento.bind(this)}),e.push({hint:"Preview",icon:"bi bi-zoom-in",onClick:(n=>{this.dialog.html({title:"Termo de ades\xe3o",modalWidth:1e3},n.conteudo||"")}).bind(this)}),e}signDocumento(t){var e=this;return(0,d.Z)(function*(){yield e.documentoService.sign([t]),e.cdRef.detectChanges()})()}get formaContagemCargaHoraria(){const t=this.form?.controls.forma_contagem_carga_horaria.value||"DIA";return"DIA"==t?"day":"SEMANA"==t?"week":"mouth"}onFormaContagemCargaHorariaChange(t){this.form.controls.forma_contagem_carga_horaria.setValue("day"==t?"DIA":"week"==t?"SEMANA":"MES")}isVigente(t){return this.form.controls.documento_id.value==t.id}buscaGestoresUnidadeExecutora(t){return t&&[t.gestor?.usuario_id,...t.gestores_substitutos?.map(e=>e.usuario_id),...t.gestores_delegados?.map(e=>e.usuario_id)].forEach(e=>{e&&this.gestoresUnidadeExecutora.push(e)}),this.gestoresUnidadeExecutora}static#a=this.\u0275fac=function(e){return new(e||i)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:i,selectors:[["plano-trabalho-form"]],viewQuery:function(e,o){if(1&e&&(a.Gf(D.Q,5),a.Gf(It,5),a.Gf(Pt,5),a.Gf(Ut,5),a.Gf(wt,5),a.Gf(Nt,5),a.Gf(Jt,5),a.Gf(Qt,5),a.Gf(St,5),a.Gf(Rt,5),a.Gf(Mt,5),a.Gf(qt,5)),2&e){let n;a.iGM(n=a.CRH())&&(o.editableForm=n.first),a.iGM(n=a.CRH())&&(o.gridAtividades=n.first),a.iGM(n=a.CRH())&&(o.gridDocumentos=n.first),a.iGM(n=a.CRH())&&(o.tabs=n.first),a.iGM(n=a.CRH())&&(o.usuario=n.first),a.iGM(n=a.CRH())&&(o.programa=n.first),a.iGM(n=a.CRH())&&(o.unidade=n.first),a.iGM(n=a.CRH())&&(o.tipoModalidade=n.first),a.iGM(n=a.CRH())&&(o.planoEntrega=n.first),a.iGM(n=a.CRH())&&(o.atividade=n.first),a.iGM(n=a.CRH())&&(o.entrega=n.first),a.iGM(n=a.CRH())&&(o.documentos=n.first)}},features:[a.qOj],decls:24,vars:36,consts:[["initialFocus","plano_entrega_id",3,"form","disabled","noButtons","submit","cancel"],["display","","right","",3,"hidden","title","select"],["tabs",""],["key","DADOS","label","Dados"],[1,"row"],[1,"col-md-12"],["required","","controlName","usuario_id",3,"size","disabled","dao","join","select"],["usuario",""],["required","","controlName","unidade_id",3,"size","disabled","dao","select"],["unidade",""],["icon","bi bi-file-bar-graph","required","","controlName","programa_id",3,"size","label","disabled","join","dao","metadata","select"],["programa",""],["date","","label","In\xedcio","icon","bi bi-calendar-date","controlName","data_inicio","required","",3,"size","control","labelInfo","change"],["date","","label","Final","icon","bi bi-calendar-date","controlName","data_fim","required","",3,"size","control","labelInfo","change"],["controlName","tipo_modalidade_id","required","",3,"size","dao"],["tipoModalidade",""],[4,"ngIf"],[3,"title"],["type","warning",3,"message",4,"ngIf"],["key","MENSAGENS",3,"label",4,"ngIf"],["key","TERMO",3,"label",4,"ngIf"],["label","Carga Hor\xe1ria","icon","bi bi-hourglass-split","controlName","carga_horaria","labelInfo","Carga hor\xe1ria do usu\xe1rio (M\xe1x.: di\xe1ria 24 horas; semana 24*5=240 horas; mensal 24*20=480 horas)","required","",3,"size","unit","control","unitChange","change"],["onlyHours","","disabled","","label","Horas Totais","icon","bi bi-clock","controlName","tempo_total","labelInfo","Horas \xfateis de trabalho no per\xedodo de vig\xeancia considerando a carga hor\xe1ria, feriados e fins de semana",3,"size","control"],["onlyHours","","disabled","","label","Horas Parciais","icon","bi bi-clock","controlName","tempo_proporcional","labelInfo","Total de horas menos os afastamentos.",3,"size","control"],["title","C\xe1lculos das horas totais","collapse","",4,"ngIf"],["title","C\xe1lculos das horas parciais","collapse","",4,"ngIf"],["title","C\xe1lculos das horas totais","collapse",""],[3,"efemerides","partial"],["title","C\xe1lculos das horas parciais","collapse",""],[3,"efemerides"],["type","warning",3,"message"],["noPersist","",3,"disabled","entity"],["key","MENSAGENS",3,"label"],["controlName","editar_texto_complementar_unidade","scale","small","labelPosition","right",3,"disabled","size","label"],["controlName","unidade_texto_complementar",3,"disabled","dataset"],["title","Texto complementar do usuario"],["controlName","editar_texto_complementar_usuario","scale","small","labelPosition","right",3,"disabled","size","label"],["controlName","usuario_texto_complementar",3,"disabled","dataset"],["key","TERMO",3,"label"],["clss","row"],["noPersist","","especie","TCR",3,"entity","disabled","cdRef","needSign","extraTags","editingId","datasource","template"],["documentos",""]],template:function(e,o){if(1&e&&(a.TgZ(0,"editable-form",0),a.NdJ("submit",function(){return o.onSaveData()})("cancel",function(){return o.onCancel()}),a.TgZ(1,"tabs",1,2)(3,"tab",3)(4,"div",4)(5,"div",5)(6,"div",4)(7,"input-search",6,7),a.NdJ("select",function(r){return o.onUsuarioSelect(r)}),a.qZA(),a.TgZ(9,"input-search",8,9),a.NdJ("select",function(r){return o.onUnidadeSelect(r)}),a.qZA(),a.TgZ(11,"input-search",10,11),a.NdJ("select",function(r){return o.onProgramaSelect(r)}),a.qZA()(),a.TgZ(13,"div",4)(14,"input-datetime",12),a.NdJ("change",function(r){return o.onDataInicioChange(r)}),a.qZA(),a.TgZ(15,"input-datetime",13),a.NdJ("change",function(r){return o.onDataFimChange(r)}),a.qZA(),a._UZ(16,"input-search",14,15),a.qZA(),a.YNc(18,Lt,7,10,"ng-container",16),a.qZA()(),a.TgZ(19,"separator",17),a.YNc(20,Gt,1,1,"top-alert",18),a.YNc(21,zt,2,2,"div",16),a.qZA()(),a.YNc(22,Yt,7,12,"tab",19),a.YNc(23,Ht,4,9,"tab",20),a.qZA()()),2&e){const n=a.MAs(17);a.Q6J("form",o.form)("disabled",o.formDisabled)("noButtons",o.isTermos?"true":void 0),a.xp6(1),a.Q6J("hidden",o.isTermos?"true":void 0)("title",o.isModal?"":o.title)("select",o.onTabSelect.bind(o)),a.xp6(6),a.Q6J("size",4)("disabled","new"==o.action?void 0:"true")("dao",o.usuarioDao)("join",a.DdM(33,Bt)),a.xp6(2),a.Q6J("size",4)("disabled","new"==o.action?void 0:"true")("dao",o.unidadeDao),a.xp6(2),a.Q6J("size",4)("label",o.lex.translate("Programa de gest\xe3o"))("disabled","new"==o.action?void 0:"true")("join",o.joinPrograma)("dao",o.programaDao)("metadata",o.programaMetadata),a.xp6(3),a.Q6J("size",3)("control",o.form.controls.data_inicio)("labelInfo","In\xedcio da Vig\xeancia do "+o.lex.translate("Plano de trabalho")),a.xp6(1),a.Q6J("size",3)("control",o.form.controls.data_fim)("labelInfo","Final da Vig\xeancia do "+o.lex.translate("Plano de trabalho")),a.xp6(1),a.Q6J("size",6)("dao",o.tipoModalidadeDao),a.xp6(2),a.Q6J("ngIf",null==n.selectedEntity?null:n.selectedEntity.plano_trabalho_calcula_horas),a.xp6(1),a.Q6J("title",o.lex.translate("Entregas")+o.lex.translate(" do plano de trabalho")),a.xp6(1),a.Q6J("ngIf",!(null!=o.form.controls.programa_id.value&&o.form.controls.programa_id.value.length&&null!=o.form.controls.unidade_id.value&&o.form.controls.unidade_id.value.length)),a.xp6(1),a.Q6J("ngIf",(null==o.form.controls.programa_id.value?null:o.form.controls.programa_id.value.length)&&(null==o.form.controls.unidade_id.value?null:o.form.controls.unidade_id.value.length)),a.xp6(1),a.Q6J("ngIf",o.checkFilled(a.DdM(34,kt))),a.xp6(1),a.Q6J("ngIf",o.checkFilled(a.DdM(35,Wt)))}},dependencies:[h.O5,D.Q,J.a,y.V,M.k,Ga.u,F.n,Y.i,I.N,za.o,ca.S,Ya.G,Ha.Y,Ba.N,W]})}return i})();var fa=s(9997),K=s(7765),ba=s(2729),jt=s(5736);function Kt(i,l){if(1&i&&a._UZ(0,"i"),2&i){const t=a.oxw();a.Tol(t.icon)}}const va=function(i){return{data:i}};function Xt(i,l){if(1&i&&a.GkF(0,5),2&i){const t=a.oxw();a.Q6J("ngTemplateOutlet",t.titleTemplate)("ngTemplateOutletContext",a.VKq(2,va,t.data))}}function $t(i,l){if(1&i&&a.GkF(0,5),2&i){const t=a.oxw(2);a.Q6J("ngTemplateOutlet",t.template)("ngTemplateOutletContext",a.VKq(2,va,t.data))}}function ae(i,l){if(1&i&&(a.TgZ(0,"div",6),a.YNc(1,$t,1,4,"ng-container",3),a.Hsn(2),a.qZA()),2&i){const t=a.oxw();a.xp6(1),a.Q6J("ngIf",t.template)}}const te=["*"];let ee=(()=>{class i extends jt.V{set class(t){this._class!=t&&(this._class=t)}get class(){return"card m-3 "+this.getClassBorderColor(this.color)+this._class}constructor(t){super(t),this.injector=t,this.collapsed=!0}ngOnInit(){}onHeaderClick(){this.collapsed=!this.collapsed,this.cdRef.detectChanges()}get style(){return this.getStyleBgColor(this.color)}static#a=this.\u0275fac=function(e){return new(e||i)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:i,selectors:[["collapse-card"]],inputs:{title:"title",data:"data",icon:"icon",collapsed:"collapsed",color:"color",template:"template",titleTemplate:"titleTemplate",class:"class"},features:[a.qOj],ngContentSelectors:te,decls:7,vars:6,consts:[[1,"card","border-primary","m-3"],["role","button",1,"card-header",3,"click"],[3,"class",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext",4,"ngIf"],["class","card-body text-primary",4,"ngIf"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"card-body","text-primary"]],template:function(e,o){1&e&&(a.F$t(),a.TgZ(0,"div",0)(1,"div",1),a.NdJ("click",function(){return o.onHeaderClick()}),a.YNc(2,Kt,1,2,"i",2),a._uU(3),a.YNc(4,Xt,1,4,"ng-container",3),a._UZ(5,"i"),a.qZA(),a.YNc(6,ae,3,1,"div",4),a.qZA()),2&e&&(a.xp6(2),a.Q6J("ngIf",o.icon),a.xp6(1),a.hij(" ",o.title||""," "),a.xp6(1),a.Q6J("ngIf",o.titleTemplate),a.xp6(1),a.Tol("collapse-card-toggle-icon "+(o.collapsed?"bi bi-chevron-down":"bi bi-chevron-up")),a.xp6(1),a.Q6J("ngIf",!o.collapsed))},dependencies:[h.O5,h.tP],styles:[".card-header[_ngcontent-%COMP%]   .fa[_ngcontent-%COMP%]{transition:.3s transform ease-in-out}.card-header[_ngcontent-%COMP%]   .collapsed[_ngcontent-%COMP%]   .fa[_ngcontent-%COMP%]{transform:rotate(90deg)}.collapse-card-toggle-icon[_ngcontent-%COMP%]{position:absolute;top:20px;right:20px}"]})}return i})();var oe=s(58),V=s(4539),ie=s(4368);class Ta extends ie.X{constructor(l){super(),this.data_inicio=new Date,this.data_fim=new Date,this.status="INCLUIDO",this.avaliacoes=[],this.status_historico=[],this.plano_trabalho_id="",this.avaliacao_id=null,this.initialization(l)}}var Ca=s(1095),X=s(6486),ne=s(3101),le=s(2981),re=s(7447),se=s(4971),de=s(7338),ce=s(9373),ue=s(6976);let me=(()=>{class i extends ue.B{constructor(t){super("Comparecimento",t),this.injector=t,this.inputSearchConfig.searchFields=["data_comparecimento"]}static#a=this.\u0275fac=function(e){return new(e||i)(a.LFG(a.zs3))};static#t=this.\u0275prov=a.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var pe=s(5034),_e=s(7819),ge=s(9756),he=s(9224),fe=s(1419),Aa=s(2504),be=s(2095);const ve=["gridEntregas"],Te=["gridAtividades"],Ce=["etiqueta"],Ae=["tipoAtividade"],ye=["listTarefas"];function xe(i,l){if(1&i&&(a.TgZ(0,"span",31),a._UZ(1,"i",32),a._uU(2),a.qZA()),2&i){const t=a.oxw().row;a.xp6(2),a.hij(" ",null==t.atividades?null:t.atividades.length,"")}}function Ee(i,l){if(1&i&&a.YNc(0,xe,3,1,"span",30),2&i){const t=l.row;a.Q6J("ngIf",null==t.atividades?null:t.atividades.length)}}function Ze(i,l){if(1&i&&(a.TgZ(0,"span",31),a._UZ(1,"i",32),a._uU(2),a.qZA()),2&i){const t=a.oxw().row;a.xp6(2),a.hij(" ",null==t.tarefas?null:t.tarefas.length,"")}}function De(i,l){if(1&i&&a.YNc(0,Ze,3,1,"span",30),2&i){const t=l.row;a.Q6J("ngIf",null==t.tarefas?null:t.tarefas.length)}}function Oe(i,l){1&i&&a._UZ(0,"atividade-list-tarefa",49,50),2&i&&a.Q6J("atividade",l.row)("consolidacao",!1)}function Ie(i,l){if(1&i&&(a.TgZ(0,"span",51),a._UZ(1,"badge",52),a.qZA(),a.TgZ(2,"span",53),a._uU(3),a.qZA(),a._UZ(4,"reaction",54)),2&i){const t=l.row,e=a.oxw(2);a.xp6(1),a.Q6J("label",t.numero)("data",t.numero)("click",e.atividadeService.onIdClick.bind(e)),a.xp6(2),a.Oqu(t.descricao),a.xp6(1),a.Q6J("entity",t)}}function Pe(i,l){if(1&i&&a._UZ(0,"input-textarea",55),2&i){const t=a.oxw(2);a.Q6J("size",12)("rows",2)("control",t.formAtividade.controls.descricao)}}function Ue(i,l){1&i&&a._UZ(0,"badge",58),2&i&&a.Q6J("badge",l.$implicit)}function we(i,l){if(1&i&&(a.TgZ(0,"div",56),a.YNc(1,Ue,1,1,"badge",57),a.qZA()),2&i){const t=l.row,e=a.oxw(2);a.xp6(1),a.Q6J("ngForOf",e.tempoAtividade(t))}}function Ne(i,l){if(1&i&&(a.TgZ(0,"separator",59),a._UZ(1,"input-datetime",60)(2,"input-datetime",61),a.qZA()),2&i){const t=a.oxw(2);a.Q6J("collapsed",!0),a.xp6(1),a.Q6J("control",t.formAtividade.controls.data_inicio),a.xp6(1),a.Q6J("control",t.formAtividade.controls.data_entrega)}}function Je(i,l){1&i&&a._UZ(0,"badge",66),2&i&&a.Q6J("lookup",l.$implicit)}function Qe(i,l){1&i&&a._UZ(0,"separator",67)}function Se(i,l){1&i&&a._UZ(0,"i",71)}function Re(i,l){if(1&i&&(a.TgZ(0,"tr")(1,"td"),a.YNc(2,Se,1,0,"i",69),a.qZA(),a.TgZ(3,"td",70),a._uU(4),a.qZA()()),2&i){const t=l.$implicit;a.xp6(2),a.Q6J("ngIf",t.checked),a.xp6(2),a.Oqu(t.texto)}}function Me(i,l){if(1&i&&(a.TgZ(0,"table"),a.YNc(1,Re,5,2,"tr",68),a.qZA()),2&i){const t=a.oxw().row;a.xp6(1),a.Q6J("ngForOf",t.checklist)}}function qe(i,l){if(1&i&&(a._UZ(0,"progress-bar",62),a.YNc(1,Je,1,1,"badge",63),a.YNc(2,Qe,1,0,"separator",64),a.YNc(3,Me,2,1,"table",65)),2&i){const t=l.row;a.Q6J("value",t.progresso),a.xp6(1),a.Q6J("ngForOf",t.etiquetas),a.xp6(1),a.Q6J("ngIf",null==t.checklist?null:t.checklist.length),a.xp6(1),a.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function Fe(i,l){1&i&&a._UZ(0,"separator",67)}function Ve(i,l){if(1&i&&(a.TgZ(0,"tr")(1,"td"),a._UZ(2,"input-switch",76),a.qZA(),a.TgZ(3,"td",70),a._uU(4),a.qZA()()),2&i){const t=l.$implicit,e=l.index,o=a.oxw(4);a.xp6(2),a.Q6J("size",12)("source",o.checklist)("path",e+".checked"),a.xp6(2),a.Oqu(t.texto)}}function Le(i,l){if(1&i&&(a.TgZ(0,"table"),a.YNc(1,Ve,5,4,"tr",68),a.qZA()),2&i){const t=a.oxw(3);a.xp6(1),a.Q6J("ngForOf",t.checklist)}}function Ge(i,l){if(1&i){const t=a.EpF();a._uU(0),a._UZ(1,"input-number",72),a.TgZ(2,"input-multiselect",73)(3,"input-select",74,75),a.NdJ("details",function(){a.CHM(t);const o=a.oxw(2);return a.KtG(o.onEtiquetaConfigClick())}),a.qZA()(),a.YNc(5,Fe,1,0,"separator",64),a.YNc(6,Le,2,1,"table",65)}if(2&i){const t=l.row,e=a.oxw(2);a.hij(" ",t._status," "),a.xp6(1),a.Q6J("size",12)("decimals",2)("control",e.formEdit.controls.progresso),a.xp6(1),a.Q6J("size",12)("control",e.formEdit.controls.etiquetas)("addItemHandle",e.addItemHandleEtiquetas.bind(e)),a.xp6(1),a.Q6J("size",12)("control",e.formEdit.controls.etiqueta)("items",e.etiquetas),a.xp6(2),a.Q6J("ngIf",null==t.checklist?null:t.checklist.length),a.xp6(1),a.Q6J("ngIf",null==t.checklist?null:t.checklist.length)}}function ze(i,l){if(1&i&&a._UZ(0,"badge",81),2&i){const t=l.$implicit;a.Q6J("data",t)("color",t.color)("icon",t.icon)("label",t.label)}}function Ye(i,l){if(1&i&&a._UZ(0,"comentarios-widget",82),2&i){const t=a.oxw().row;a.oxw();const e=a.MAs(1);a.Q6J("entity",t)("selectable",!1)("grid",e)}}function He(i,l){if(1&i&&(a._UZ(0,"documentos-badge",77),a.TgZ(1,"span",78),a.YNc(2,ze,1,4,"badge",79),a.qZA(),a.YNc(3,Ye,1,3,"comentarios-widget",80)),2&i){const t=l.row;a.oxw();const e=a.MAs(1),o=a.oxw();a.Q6J("documento",t.documento_requisicao),a.xp6(2),a.Q6J("ngForOf",o.atividadeService.getStatus(t,o.entity)),a.xp6(1),a.Q6J("ngIf",!e.editing)}}const Be=function(){return{abrirEmEdicao:!0}};function ke(i,l){if(1&i&&(a.TgZ(0,"grid",33,34)(2,"columns")(3,"column",35),a.YNc(4,De,1,1,"ng-template",null,36,a.W1O),a.YNc(6,Oe,2,2,"ng-template",null,37,a.W1O),a.qZA(),a.TgZ(8,"column",38),a.YNc(9,Ie,5,5,"ng-template",null,39,a.W1O),a.YNc(11,Pe,1,3,"ng-template",null,40,a.W1O),a.qZA(),a.TgZ(13,"column",41),a.YNc(14,we,2,1,"ng-template",null,42,a.W1O),a.YNc(16,Ne,3,3,"ng-template",null,43,a.W1O),a.qZA(),a.TgZ(18,"column",44),a.YNc(19,qe,4,4,"ng-template",null,45,a.W1O),a.YNc(21,Ge,7,12,"ng-template",null,46,a.W1O),a.qZA(),a.TgZ(23,"column",41),a.YNc(24,He,4,3,"ng-template",null,47,a.W1O),a.qZA(),a._UZ(26,"column",48),a.qZA()()),2&i){const t=l.row,e=a.MAs(5),o=a.MAs(7),n=a.MAs(10),r=a.MAs(12),m=a.MAs(15),p=a.MAs(17),_=a.MAs(20),c=a.MAs(22),f=a.MAs(25),u=a.oxw();a.Q6J("items",t.atividades)("minHeight",0)("form",u.formAtividade)("hasAdd",!u.disabled)("hasDelete",!1)("hasEdit",!1)("add",u.addAtividade.bind(u,t.entrega))("load",u.loadAtividade.bind(u))("remove",u.removeAtividade.bind(u,t.atividades))("save",u.saveAtividade.bind(u)),a.xp6(3),a.Q6J("width",50)("align","center")("hint","Tarefas da "+u.lex.translate("atividade"))("template",e)("expandTemplate",o),a.xp6(5),a.Q6J("title","#ID/Trabalho executado")("width",400)("template",n)("editTemplate",r)("columnEditTemplate",r)("edit",u.onColumnAtividadeDescricaoEdit.bind(u))("save",u.onColumnAtividadeDescricaoSave.bind(u))("metadata",a.DdM(42,Be)),a.xp6(5),a.Q6J("title","In\xedcio e Conclus\xe3o")("width",250)("template",m)("editTemplate",p),a.xp6(5),a.Q6J("title","Progresso\nEtiquetas/Checklist")("width",200)("template",_)("editTemplate",_)("columnEditTemplate",c)("edit",u.onColumnProgressoEtiquetasChecklistEdit.bind(u))("save",u.onColumnProgressoEtiquetasChecklistSave.bind(u))("canEdit",u.podeEditar.bind(u)),a.xp6(5),a.Q6J("title","n\xba Processo/Status\nComent\xe1rios")("width",300)("template",f)("editTemplate",f),a.xp6(3),a.Q6J("metadata",u.atividadeOptionsMetadata)("dynamicOptions",u.atividadeService.dynamicOptions.bind(u))("dynamicButtons",u.atividadeService.dynamicButtons.bind(u))}}function We(i,l){if(1&i&&a._UZ(0,"badge",83),2&i){const t=l.row;a.Q6J("label",t.badge.titulo)("color",t.badge.cor)}}function je(i,l){if(1&i&&(a._uU(0),a._UZ(1,"br"),a.TgZ(2,"small"),a._uU(3),a.qZA(),a._UZ(4,"reaction",84)),2&i){const t=l.row;a.hij(" ",t.badge.descricao||t.entrega.descricao,""),a.xp6(3),a.Oqu(t.entrega.descricao),a.xp6(1),a.Q6J("entity",t.entrega)}}function Ke(i,l){1&i&&a._UZ(0,"badge",85),2&i&&a.Q6J("label",l.row.entrega.forca_trabalho+"%")}function Xe(i,l){if(1&i&&a._UZ(0,"badge",86)(1,"br")(2,"badge",87),2&i){const t=l.row;a.Q6J("textValue",t.meta),a.xp6(2),a.Q6J("textValue",t.metaRealizado)}}function $e(i,l){1&i&&a._UZ(0,"progress-bar",62),2&i&&a.Q6J("value",l.row.progresso_realizado)}function ao(i,l){if(1&i&&(a._UZ(0,"badge",88),a._uU(1)),2&i){const t=l.row;a.Q6J("color",t.tipo_motivo_afastamento.cor)("icon",t.tipo_motivo_afastamento.icone)("label",t.tipo_motivo_afastamento.nome),a.xp6(1),a.hij(" ",t.observacao," ")}}function to(i,l){if(1&i&&a._UZ(0,"badge",89),2&i){const t=l.row,e=a.oxw();a.Q6J("icon",e.entityService.getIcon("Unidade"))("label",t.unidade.sigla)("textValue",t.unidade.nome)}}function eo(i,l){if(1&i&&a._UZ(0,"input-search",90,91),2&i){const t=a.oxw();a.Q6J("size",6)("dao",t.unidadeDao)}}let ya=(()=>{class i extends S.D{set noPersist(t){super.noPersist=t}get noPersist(){return super.noPersist}set control(t){super.control=t}get control(){return super.control}set entity(t){super.entity=t,this.bindEntity()}get entity(){return super.entity}set disabled(t){(this._disabled!=t||this.atividadeOptionsMetadata.disabled!==t)&&(this._disabled=t,this.atividadeOptionsMetadata.disabled=t,this.cdRef.detectChanges())}get disabled(){return this._disabled}constructor(t){super(t),this.injector=t,this.joinAtividade=["demandante","usuario","tipo_atividade","comentarios.usuario:id,nome,apelido","reacoes.usuario:id,nome,apelido"],this.itemsEntregas=[],this.etiquetas=[],this.etiquetasAscendentes=[],this.itemsOcorrencias=[],this.itemsComparecimentos=[],this.itemsAfastamentos=[],this._disabled=!0,this.validateAtividade=(e,o)=>{let n=null;return["descricao"].indexOf(o)>=0&&!e.value?.length?n="Obrigat\xf3rio":["data_inicio","data_entrega"].includes(o)&&!this.util.isDataValid(e.value)?n="Inv\xe1lido":"data_inicio"==o&&e.value.getTime()<this.formAtividade?.controls.data_distribuicao.value.getTime()||"data_entrega"==o&&e.value.getTime()<this.formAtividade?.controls.data_distribuicao.value.getTime()?n="Menor que distribui\xe7\xe3o":"data_entrega"==o&&e.value.getTime()<this.formAtividade?.controls.data_inicio.value.getTime()&&(n="Menor que in\xedcio"),n},this.validateComparecimento=(e,o)=>{let n=null;return["detalhamento","unidade_id"].indexOf(o)>=0&&!e.value?.length?n="Obrigat\xf3rio":"data_comparecimento"==o&&this.entity&&!this.util.between(e.value,{start:this.entity.data_inicio,end:this.entity.data_fim})&&(n="Inv\xe1lido"),n},this.cdRef=t.get(a.sBO),this.dao=t.get(V.E),this.unidadeDao=t.get(N.J),this.comparecimentoDao=t.get(me),this.atividadeDao=t.get(se.P),this.atividadeService=t.get(de.s),this.calendar=t.get(ua.o),this.ocorrenciaDao=t.get(pe.u),this.tipoAtividadeDao=t.get(le.Y),this.planoTrabalhoService=t.get(Q.p),this.planoEntregaService=t.get(re.f),this.pEEDao=t.get(ma.K),this.formAtividade=this.fh.FormBuilder({descricao:{default:""},etiquetas:{default:[]},checklist:{default:[]},comentarios:{default:[]},esforco:{default:0},tempo_planejado:{default:0},data_distribuicao:{default:new Date},data_estipulada_entrega:{default:new Date},data_inicio:{default:new Date},data_entrega:{default:new Date}},this.cdRef,this.validateAtividade),this.formComparecimento=this.fh.FormBuilder({data_comparecimento:{default:new Date},unidade_id:{default:""},detalhamento:{default:""}},this.cdRef,this.validateComparecimento),this.formEdit=this.fh.FormBuilder({descricao:{default:""},comentarios:{default:[]},progresso:{default:0},etiquetas:{default:[]},etiqueta:{default:null}}),this.atividadeOptionsMetadata={refreshId:this.atividadeRefreshId.bind(this),removeId:this.atividadeRemoveId.bind(this),refresh:this.refresh.bind(this)}}refresh(){this.loadData(this.entity,this.form)}bindEntity(){this.entity&&(this.entity._metadata=this.entity._metadata||{},this.entity._metadata.planoTrabalhoConsolidacaoFormComponent=this)}atividadeRefreshId(t,e){this.itemsEntregas.forEach(o=>{let n=o.atividades.findIndex(r=>r.id==t);n>=0&&(e?o.atividades[n]=e:this.atividadeDao.getById(t,this.joinAtividade).then(r=>{r&&(o.atividades[n]=r)}))}),this.cdRef.detectChanges()}atividadeRemoveId(t){this.itemsEntregas.forEach(e=>{let o=e.atividades.findIndex(n=>n.id==t);o>=0&&e.atividades.splice(o,1)}),this.cdRef.detectChanges()}ngAfterViewInit(){var t=this;super.ngAfterViewInit(),(0,d.Z)(function*(){yield t.loadData(t.entity,t.form)})()}loadConsolidacao(t){this.itemsEntregas=t.entregas.map(e=>(e.plano_entrega_entrega&&(e.plano_entrega_entrega.plano_entrega=t.planosEntregas.find(n=>n.id==e.plano_entrega_entrega?.plano_entrega_id)),{id:e.id,entrega:e,atividades:t.atividades.filter(n=>n.plano_trabalho_entrega_id==e.id),badge:this.planoTrabalhoService.tipoEntrega(e,t.planoTrabalho),meta:e.plano_entrega_entrega?this.planoEntregaService.getValorMeta(e.plano_entrega_entrega):"",metaRealizado:e.plano_entrega_entrega?this.planoEntregaService.getValorRealizado(e.plano_entrega_entrega):"",progresso_realizado:e.plano_entrega_entrega?e.plano_entrega_entrega.progresso_realizado:0,objetivos:e.plano_entrega_entrega?e.plano_entrega_entrega.objetivos:[],processos:e.plano_entrega_entrega?e.plano_entrega_entrega.processos:[]})),this.programa=t.programa,this.planoTrabalho=t.planoTrabalho,this.itemsOcorrencias=t.ocorrencias,this.itemsComparecimentos=t.comparecimentos,this.itemsAfastamentos=t.afastamentos,this.unidade=t.planoTrabalho.unidade||this.entity.plano_trabalho?.unidade,this.cdRef.detectChanges()}loadData(t,e){var o=this;return(0,d.Z)(function*(){o.gridEntregas.loading=!0,o.cdRef.detectChanges();try{let n=yield o.dao.dadosConsolidacao(t.id);o.loadConsolidacao(n)}finally{o.gridEntregas.loading=!1,o.cdRef.detectChanges()}})()}addAtividade(t){var e=this;return(0,d.Z)(function*(){let o=t.plano_trabalho||e.entity.plano_trabalho,n=e.calendar.calculaDataTempoUnidade(e.entity.data_inicio,e.entity.data_fim,o.carga_horaria,e.unidade,"ENTREGA");const r=e.calendar.horasUteis(e.entity.data_inicio,e.entity.data_fim,o.carga_horaria,e.unidade,"DISTRIBUICAO"),m=e.util.maxDate(e.util.setTime(e.entity.data_inicio,0,0,0),o.data_inicio),p=e.util.minDate(e.util.setTime(e.entity.data_fim,23,59,59),o.data_fim);let _=e.dao.generateUuid();return new ne.a({id:_,plano_trabalho:o,plano_trabalho_entrega:t,plano_trabalho_consolidacao:e.entity,demandante:e.auth.usuario,usuario:e.auth.usuario,unidade:e.unidade,data_distribuicao:m,carga_horaria:o.carga_horaria,data_estipulada_entrega:p,data_inicio:m,data_entrega:p,tempo_planejado:r,tempo_despendido:n?.tempoUtil||0,status:"CONCLUIDO",progresso:100,plano_trabalho_id:e.entity.plano_trabalho_id,plano_trabalho_entrega_id:t.id,plano_trabalho_consolidacao_id:e.entity.id,demandante_id:e.auth.usuario.id,usuario_id:e.auth.usuario.id,unidade_id:e.unidade.id,metadados:{atrasado:!1,tempo_despendido:0,tempo_atraso:0,pausado:!1,iniciado:!0,concluido:!0,avaliado:!1,arquivado:!1,produtividade:0,extra:void 0,_status:[]},_status:"temporario"})})()}loadAtividade(t,e){var o=this;return(0,d.Z)(function*(){o.formAtividade.patchValue(e),o.cdRef.detectChanges()})()}removeAtividade(t,e){var o=this;return(0,d.Z)(function*(){if(!(yield o.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")))return!1;try{let r=e;return yield o.atividadeDao?.delete(r),t.splice(t.findIndex(m=>m.id==r.id),1),!0}catch{return!1}})()}saveAtividade(t,e){var o=this;return(0,d.Z)(function*(){let n;if(o.gridAtividades.error="",o.formAtividade.markAllAsTouched(),o.formAtividade.valid){e.id="NEW"==e.id?o.dao.generateUuid():e.id,o.util.fillForm(e,o.formAtividade.value),o.submitting=!0;try{n=yield o.atividadeDao?.save(e,o.joinAtividade,["etiquetas","checklist","comentarios","pausas","tarefas"]),o.atividadeRefreshId(e.id,n)}catch(r){n=!1,o.gridAtividades.error=r.message||r}finally{o.submitting=!1}}return n})()}onDataDistribuicaoChange(t){this.formAtividade.controls.data_inicio.setValue(this.formAtividade.controls.data_distribuicao.value)}onDataEstipuladaEntregaChange(t){this.formAtividade.controls.data_entrega.setValue(this.formAtividade.controls.data_estipulada_entrega.value)}atividadeDynamicButtons(t){let e=[];return e.push(Object.assign({},this.gridEntregas.BUTTON_EDIT,{})),e.push(Object.assign({},this.gridEntregas.BUTTON_DELETE,{})),e}onColumnProgressoEtiquetasChecklistEdit(t){var e=this;return(0,d.Z)(function*(){if(!e.etiquetasAscendentes.filter(o=>o.data==t.plano_trabalho.unidade.id).length){let o=yield e.carregaEtiquetasUnidadesAscendentes(t.plano_trabalho.unidade);e.etiquetasAscendentes.push(...o)}e.formEdit.controls.progresso.setValue(t.progresso),e.formEdit.controls.etiquetas.setValue(t.etiquetas),e.formEdit.controls.etiqueta.setValue(null),e.etiquetas=e.util.merge(t.tipo_atividade?.etiquetas,t.plano_trabalho.unidade?.etiquetas,(o,n)=>o.key==n.key),e.etiquetas=e.util.merge(e.etiquetas,e.auth.usuario.config?.etiquetas,(o,n)=>o.key==n.key),e.etiquetas=e.util.merge(e.etiquetas,e.etiquetasAscendentes.filter(o=>o.data==t.plano_trabalho.unidade.id),(o,n)=>o.key==n.key),e.checklist=e.util.clone(t.checklist)})()}carregaEtiquetasUnidadesAscendentes(t){var e=this;return(0,d.Z)(function*(){let o=[];if((t=t||e.auth.unidade).path){let n=t.path.split("/");(yield e.unidadeDao.query({where:[["id","in",n]]}).asPromise()).forEach(m=>{o=e.util.merge(o,m.etiquetas,(p,_)=>p.key==_.key)}),o.forEach(m=>m.data=t.id)}return o})()}onColumnProgressoEtiquetasChecklistSave(t){var e=this;return(0,d.Z)(function*(){try{const o=yield e.atividadeDao.update(t.id,{progresso:e.formEdit.controls.progresso.value,etiquetas:e.formEdit.controls.etiquetas.value,checklist:e.checklist});return t.progresso=e.formEdit.controls.progresso.value,t.checklist=e.checklist,!!o}catch{return!1}})()}onEtiquetaConfigClick(){this.go.navigate({route:["configuracoes","preferencia","usuario",this.auth.usuario.id],params:{etiquetas:!0}},{modal:!0,modalClose:t=>{this.etiquetas=this.util.merge(this.etiquetas,this.auth.usuario.config?.etiquetas,(e,o)=>e.key==o.key),this.cdRef.detectChanges()}})}addItemHandleEtiquetas(){let t;if(this.etiqueta&&this.etiqueta.selectedItem){const e=this.etiqueta.selectedItem,o=e.key?.length?e.key:this.util.textHash(e.value);this.util.validateLookupItem(this.formEdit.controls.etiquetas.value,o)&&(t={key:o,value:e.value,color:e.color,icon:e.icon},this.formEdit.controls.etiqueta.setValue(null))}return t}podeEditar(t){return!t._status}loadTipoAtividade(t){t?(this.etiquetas=this.atividadeService.buildEtiquetas(this.unidade,t),this.atividadeService.buildChecklist(t,this.formAtividade.controls.checklist),this.formAtividade.controls.esforco.setValue(t?.esforco||0)):(this.etiquetas=[],this.formAtividade.controls.esforco.setValue(0)),this.cdRef.detectChanges()}onTipoAtividadeSelect(t){const e=t.entity;this.loadTipoAtividade(e),this.atividadeService.comentarioAtividade(e,this.formAtividade.controls.comentarios),this.cdRef.detectChanges()}onColumnAtividadeDescricaoEdit(t){var e=this;return(0,d.Z)(function*(){e.formAtividade.controls.descricao.setValue(t.descricao),e.formAtividade.controls.comentarios.setValue(t.comentarios)})()}onColumnAtividadeDescricaoSave(t){var e=this;return(0,d.Z)(function*(){try{e.atividadeService.comentarioAtividade(e.tipoAtividade?.selectedEntity,e.formAtividade.controls.comentarios);const o=yield e.atividadeDao.update(t.id,{descricao:e.formAtividade.controls.descricao.value,comentarios:(e.formAtividade.controls.comentarios.value||[]).filter(n=>["ADD","EDIT","DELETE"].includes(n._status||""))});return t.descricao=e.formAtividade.controls.descricao.value,t.tipo_atividade=e.tipoAtividade?.selectedEntity||null,t.comentarios=e.formAtividade.controls.comentarios.value,!!o}catch{return!1}})()}tempoAtividade(t){let e=[{color:"light",hint:"In\xedcio",icon:"bi bi-file-earmark-play",label:this.dao.getDateTimeFormatted(t.data_inicio)}],o=this.atividadeService.temposAtividade(t);return o=o.filter(n=>"bi bi-file-earmark-plus"!=n.icon&&"bi bi-calendar-check"!=n.icon),e.push(...o),e}dynamicButtons(t){let e=[];return e.push({label:"Detalhes",icon:"bi bi-eye",color:"btn-outline-success",onClick:this.showDetalhes.bind(this)}),e}showDetalhes(t){var e=this;return(0,d.Z)(function*(){let o=yield e.pEEDao.getById(t.entrega.plano_entrega_entrega.id,["entrega","objetivos.objetivo"]);e.go.navigate({route:["gestao","plano-entrega","entrega",t.entrega.plano_entrega_entrega.id,"detalhes"]},{metadata:{plano_entrega:t.entrega.plano_entrega_entrega.plano_entrega,planejamento_id:t.entrega.plano_entrega_entrega.plano_entrega.planejamento_id,cadeia_valor_id:t.entrega.plano_entrega_entrega.plano_entrega.cadeia_valor_id,unidade_id:t.entrega.plano_entrega_entrega.plano_entrega.unidade_id,entrega:o}})})()}addOcorrencia(){var t=this;return(0,d.Z)(function*(){t.go.navigate({route:["gestao","ocorrencia","new"]},{metadata:{consolidacao:t.entity,planoTrabalho:t.planoTrabalho},modalClose:e=>{e&&t.refresh()}})})()}editOcorrencia(t){var e=this;return(0,d.Z)(function*(){e.go.navigate({route:["gestao","ocorrencia",t.id,"edit"]},{modalClose:o=>{o&&e.refresh()}})})()}removeOcorrencia(t){var e=this;return(0,d.Z)(function*(){if(yield e.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")){e.submitting=!0;try{let o=t;yield e.ocorrenciaDao?.delete(o),e.itemsOcorrencias.splice(e.itemsOcorrencias.findIndex(n=>n.id==o.id),1)}finally{e.submitting=!1}}})()}ocorrenciaDynamicButtons(t){let e=[];return!this.disabled&&this.auth.hasPermissionTo("MOD_OCOR_EDT")&&e.push(Object.assign({},this.OPTION_ALTERAR,{onClick:this.editOcorrencia.bind(this)})),!this.disabled&&this.auth.hasPermissionTo("MOD_OCOR_EXCL")&&e.push(Object.assign({},this.OPTION_EXCLUIR,{onClick:this.removeOcorrencia.bind(this)})),e}addComparecimento(){var t=this;return(0,d.Z)(function*(){return new ce.V({unidade_id:t.unidade?.id,unidade:t.unidade,plano_trabalho_consolidacao_id:t.entity.id})})()}loadComparecimento(t,e){var o=this;return(0,d.Z)(function*(){o.formComparecimento.patchValue({data_comparecimento:e.data_comparecimento,unidade_id:e.unidade_id,detalhamento:e.detalhamento}),o.cdRef.detectChanges()})()}removeComparecimento(t){var e=this;return(0,d.Z)(function*(){if(!(yield e.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")))return!1;try{let n=t;return yield e.comparecimentoDao?.delete(n),e.itemsComparecimentos.splice(e.itemsComparecimentos.findIndex(r=>r.id==n.id),1),!0}catch{return!1}})()}saveComparecimento(t,e){var o=this;return(0,d.Z)(function*(){let n;if(o.formComparecimento.markAllAsTouched(),o.formComparecimento.valid){e.id="NEW"==e.id?o.dao.generateUuid():e.id,e.data_comparecimento=t.controls.data_comparecimento.value,e.detalhamento=t.controls.detalhamento.value,e.plano_trabalho_consolidacao_id=o.entity.id,e.unidade_id=t.controls.unidade_id.value,o.submitting=!0;try{n=yield o.comparecimentoDao?.save(e)}finally{o.submitting=!1}}return n})()}comparecimentoDynamicButtons(t){return[]}addAfastamento(){var t=this;return(0,d.Z)(function*(){t.go.navigate({route:["gestao","afastamento","new"]},{metadata:{consolidacao:t.entity},filterSnapshot:void 0,querySnapshot:void 0,modalClose:e=>{e&&t.refresh()}})})()}afastamentoDynamicButtons(t){let e=[];return e.push(Object.assign({},this.OPTION_INFORMACOES,{onClick:o=>this.go.navigate({route:["gestao","afastamento",o.id,"consult"]})})),e}showPlanejamento(t){var e=this;return(0,d.Z)(function*(){e.go.navigate({route:["gestao","planejamento",t,"consult"]},{modal:!0})})()}showCadeiaValor(t){var e=this;return(0,d.Z)(function*(){e.go.navigate({route:["gestao","cadeia-valor",t,"consult"]},{modal:!0})})()}static#a=this.\u0275fac=function(e){return new(e||i)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:i,selectors:[["plano-trabalho-consolidacao-form"]],viewQuery:function(e,o){if(1&e&&(a.Gf(D.Q,5),a.Gf(ve,5),a.Gf(Te,5),a.Gf(Ce,5),a.Gf(Ae,5),a.Gf(ye,5)),2&e){let n;a.iGM(n=a.CRH())&&(o.editableForm=n.first),a.iGM(n=a.CRH())&&(o.gridEntregas=n.first),a.iGM(n=a.CRH())&&(o.gridAtividades=n.first),a.iGM(n=a.CRH())&&(o.etiqueta=n.first),a.iGM(n=a.CRH())&&(o.tipoAtividade=n.first),a.iGM(n=a.CRH())&&(o.listTarefas=n.first)}},inputs:{cdRef:"cdRef",planoTrabalho:"planoTrabalho",noPersist:"noPersist",control:"control",entity:"entity",disabled:"disabled"},features:[a.qOj],decls:47,vars:54,consts:[["collapse","",3,"collapsed","title","icon"],[3,"items","minHeight","hasEdit"],["gridEntregas",""],["type","expand",3,"width","icon","align","hint","template","expandTemplate"],["columnConsolidacao",""],["columnExpandedConsolidacao",""],["title","Origem",3,"template","width"],["columnOrigem",""],["title","Entrega",3,"template"],["columnEntrega",""],["title","% CHD Planejado",3,"template","width","titleHint"],["columnForcaTrabalho",""],[3,"title","template","width"],["columnMetaRealizado",""],["title","Progresso",3,"template","width"],["columnProgresso",""],["type","options",3,"dynamicButtons"],["editable","",3,"items","minHeight","hasEdit","hasDelete","hasAdd","add"],["gridAfastamento",""],["title","In\xedcio","type","datetime","field","data_inicio",3,"width"],["title","Fim","type","datetime","field","data_fim",3,"width"],["title","Motivo/Observa\xe7\xe3o",3,"template"],["columnMotivoObservacao",""],["editable","",3,"items","minHeight","form","hasDelete","hasAdd","hasEdit","add","load","remove","save"],["gridComparecimento",""],["title","Data","type","date","field","data_comparecimento",3,"width"],["title","Unidade",3,"template","editTemplate"],["columnUnidade",""],["editUnidade",""],["title","Detalhamento","type","text","field","detalhamento"],["class","badge rounded-pill bg-light text-dark",4,"ngIf"],[1,"badge","rounded-pill","bg-light","text-dark"],[1,"bi","bi-boxes"],["editable","",3,"items","minHeight","form","hasAdd","hasDelete","hasEdit","add","load","remove","save"],["gridAtividades",""],["type","expand","icon","bi bi-boxes",3,"width","align","hint","template","expandTemplate"],["columnTarefas",""],["columnExpandedTarefas",""],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save","metadata"],["columnAtividadeDescricao",""],["editAtividadeDescricao",""],[3,"title","width","template","editTemplate"],["columnTempos",""],["editTempos",""],[3,"title","width","template","editTemplate","columnEditTemplate","edit","save","canEdit"],["columnProgressoEtiquetasChecklist",""],["columnProgressoEtiquetasChecklistEdit",""],["columnNumero",""],["type","options",3,"metadata","dynamicOptions","dynamicButtons"],["persist","",3,"atividade","consolidacao"],["listTarefas",""],[1,"text-nowrap","d-block"],["icon","bi bi-hash","color","light",3,"label","data","click"],[1,"micro-text","fw-ligh","atividade-descricao"],["origem","ATIVIDADE",3,"entity"],["label","Descri\xe7\xe3o","controlName","descricao","required","",3,"size","rows","control"],[1,"one-per-line"],[3,"badge",4,"ngFor","ngForOf"],[3,"badge"],["title","In\xedcio e Conclus\xe3o","collapse","",3,"collapsed"],["icon","bi bi-play-circle","label","In\xedcio","controlName","data_inicio","labelInfo","Data de inicializa\xe7\xe3o da atividade",3,"control"],["icon","bi bi-check-circle","label","Conclus\xe3o","controlName","data_entrega","labelInfo","Data da conclus\xe3o da atividade",3,"control"],["color","success",3,"value"],[3,"lookup",4,"ngFor","ngForOf"],["small","","title","Checklist",4,"ngIf"],[4,"ngIf"],[3,"lookup"],["small","","title","Checklist"],[4,"ngFor","ngForOf"],["class","bi bi-check-circle",4,"ngIf"],[1,"micro-text","fw-ligh"],[1,"bi","bi-check-circle"],["label","Progresso","sufix","%","icon","bi bi-clock","controlName","progresso","labelInfo","Progresso de execu\xe7\xe3o (% Conclu\xeddo)",3,"size","decimals","control"],["controlName","etiquetas",3,"size","control","addItemHandle"],["label","Etiqueta","controlName","etiqueta","nullable","","itemNull","- Selecione -","detailsButton","","detailsButtonIcon","bi bi-tools",3,"size","control","items","details"],["etiqueta",""],["scale","small",3,"size","source","path"],[3,"documento"],[1,"d-block"],[3,"data","color","icon","label",4,"ngFor","ngForOf"],["origem","ATIVIDADE",3,"entity","selectable","grid",4,"ngIf"],[3,"data","color","icon","label"],["origem","ATIVIDADE",3,"entity","selectable","grid"],[3,"label","color"],["origem","PLANO_TRABALHO_ENTREGA",3,"entity"],["color","light",3,"label"],["icon","bi bi-graph-up-arrow","color","light","hint","Meta",3,"textValue"],["icon","bi bi-check-lg","color","light","hint","Realizado",3,"textValue"],[3,"color","icon","label"],["color","success",3,"icon","label","textValue"],["label","","icon","","controlName","unidade_id",3,"size","dao"],["unidade",""]],template:function(e,o){if(1&e&&(a.TgZ(0,"separator",0)(1,"grid",1,2)(3,"columns")(4,"column",3),a.YNc(5,Ee,1,1,"ng-template",null,4,a.W1O),a.YNc(7,ke,27,43,"ng-template",null,5,a.W1O),a.qZA(),a.TgZ(9,"column",6),a.YNc(10,We,1,2,"ng-template",null,7,a.W1O),a.qZA(),a.TgZ(12,"column",8),a.YNc(13,je,5,3,"ng-template",null,9,a.W1O),a.qZA(),a.TgZ(15,"column",10),a.YNc(16,Ke,1,1,"ng-template",null,11,a.W1O),a.qZA(),a.TgZ(18,"column",12),a.YNc(19,Xe,3,2,"ng-template",null,13,a.W1O),a.qZA(),a.TgZ(21,"column",14),a.YNc(22,$e,1,1,"ng-template",null,15,a.W1O),a.qZA(),a._UZ(24,"column",16),a.qZA()()(),a.TgZ(25,"separator",0)(26,"grid",17,18)(28,"columns"),a._UZ(29,"column",19)(30,"column",20),a.TgZ(31,"column",21),a.YNc(32,ao,2,4,"ng-template",null,22,a.W1O),a.qZA(),a._UZ(34,"column",16),a.qZA()()(),a.TgZ(35,"separator",0)(36,"grid",23,24)(38,"columns"),a._UZ(39,"column",25),a.TgZ(40,"column",26),a.YNc(41,to,1,3,"ng-template",null,27,a.W1O),a.YNc(43,eo,2,2,"ng-template",null,28,a.W1O),a.qZA(),a._UZ(45,"column",29)(46,"column",16),a.qZA()()()),2&e){const n=a.MAs(6),r=a.MAs(8),m=a.MAs(11),p=a.MAs(14),_=a.MAs(17),c=a.MAs(20),f=a.MAs(23),u=a.MAs(33),A=a.MAs(42),Z=a.MAs(44);a.Q6J("collapsed",!1)("title",o.lex.translate("Atividades"))("icon",o.entityService.getIcon("Atividade")),a.xp6(1),a.Q6J("items",o.itemsEntregas)("minHeight",0)("hasEdit",!1),a.xp6(3),a.Q6J("width",50)("icon",o.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("hint",o.lex.translate("Consolida\xe7\xe3o"))("template",n)("expandTemplate",r),a.xp6(5),a.Q6J("template",m)("width",200),a.xp6(3),a.Q6J("template",p),a.xp6(3),a.Q6J("template",_)("width",100)("titleHint","% Carga Hor\xe1ria Dispon\xedvel Planejada"),a.xp6(3),a.Q6J("title","Meta")("template",c)("width",100),a.xp6(3),a.Q6J("template",f)("width",150),a.xp6(3),a.Q6J("dynamicButtons",o.dynamicButtons.bind(o)),a.xp6(1),a.Q6J("collapsed",!1)("title",o.lex.translate("Afastamentos"))("icon",o.entityService.getIcon("Afastamento")),a.xp6(1),a.Q6J("items",o.itemsAfastamentos)("minHeight",0)("hasEdit",!1)("hasDelete",!1)("hasAdd",!o.disabled)("add",o.addAfastamento.bind(o)),a.xp6(3),a.Q6J("width",300),a.xp6(1),a.Q6J("width",300),a.xp6(1),a.Q6J("template",u),a.xp6(3),a.Q6J("dynamicButtons",o.afastamentoDynamicButtons.bind(o)),a.xp6(1),a.Q6J("collapsed",!1)("title",o.lex.translate("Comparecimentos"))("icon",o.entityService.getIcon("Comparecimento")),a.xp6(1),a.Q6J("items",o.itemsComparecimentos)("minHeight",0)("form",o.formComparecimento)("hasDelete",!o.disabled)("hasAdd",!o.disabled)("hasEdit",!o.disabled)("add",o.addComparecimento.bind(o))("load",o.loadComparecimento.bind(o))("remove",o.removeComparecimento.bind(o))("save",o.saveComparecimento.bind(o)),a.xp6(3),a.Q6J("width",300),a.xp6(1),a.Q6J("template",A)("editTemplate",Z),a.xp6(6),a.Q6J("dynamicButtons",o.comparecimentoDynamicButtons.bind(o))}},dependencies:[h.sg,h.O5,C.M,P.a,U.b,J.a,y.V,pa.Q,M.k,B.p,_e.p,I.N,E.F,ge.R,he.l,_a.C,fe.y,Aa.h,be.u]})}return i})();function oo(i,l){}function io(i,l){if(1&i&&a._UZ(0,"plano-trabalho-consolidacao-form",16,17),2&i){const t=l.row,e=a.oxw();a.Q6J("disabled",e.isDisabled(t))("entity",t)("planoTrabalho",e.entity)("cdRef",e.cdRef)}}function no(i,l){if(1&i&&a._uU(0),2&i){const t=l.row,e=a.oxw();a.hij(" ",e.util.getDateFormatted(t.data_inicio)," ")}}function lo(i,l){if(1&i&&a._uU(0),2&i){const t=l.row,e=a.oxw();a.hij(" ",e.util.getDateFormatted(t.data_fim)," ")}}function ro(i,l){if(1&i){const t=a.EpF();a.TgZ(0,"avaliar-nota-badge",20),a.NdJ("click",function(){a.CHM(t);const o=a.oxw().row,n=a.oxw();return a.KtG(n.mostrarAvaliacao(o))}),a.qZA()}if(2&i){const t=a.oxw().row,e=a.oxw();a.Q6J("align","left")("tipoAvaliacao",t.avaliacao.tipo_avaliacao||e.entity.programa.tipo_avaliacao_plano_trabalho)("nota",t.avaliacao.nota)}}function so(i,l){if(1&i&&(a.TgZ(0,"separator",21)(1,"small"),a._uU(2),a.qZA()()),2&i){const t=a.oxw().row;a.Q6J("collapsed",!1),a.xp6(2),a.Oqu(t.avaliacao.recurso)}}function co(i,l){if(1&i&&(a.YNc(0,ro,1,3,"avaliar-nota-badge",18),a.YNc(1,so,3,2,"separator",19)),2&i){const t=l.row;a.Q6J("ngIf",t.avaliacao),a.xp6(1),a.Q6J("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}function uo(i,l){1&i&&a._UZ(0,"badge",25)}function mo(i,l){if(1&i&&(a.TgZ(0,"div",22),a._UZ(1,"badge",23),a.YNc(2,uo,1,0,"badge",24),a.qZA()),2&i){const t=l.row,e=a.oxw();a.xp6(1),a.Q6J("color",e.lookup.getColor(e.lookup.CONSOLIDACAO_STATUS,t.status))("icon",e.lookup.getIcon(e.lookup.CONSOLIDACAO_STATUS,t.status))("label",e.lookup.getValue(e.lookup.CONSOLIDACAO_STATUS,t.status)),a.xp6(1),a.Q6J("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}let xa=(()=>{class i extends S.D{set entity(t){super.entity=t}get entity(){return super.entity}get items(){return this.entity?.consolidacoes||[]}constructor(t){super(t),this.injector=t,this.validate=(e,o)=>null,this.dao=t.get(V.E),this.avaliacaoDao=t.get(Ca.w),this.planoTrabalhoService=t.get(Q.p),this.unidadeService=t.get(H.Z),this.planoTrabalhoDao=t.get(w.t),this.title=this.lex.translate("Consolida\xe7\xf5es"),this.code="MOD_PTR_CSLD",this.modalWidth=1200,this.form=this.fh.FormBuilder({data_inicio:{default:new Date},data_fim:{default:new Date}},this.cdRef,this.validate)}ngAfterViewInit(){var t=this;super.ngAfterViewInit(),(0,d.Z)(function*(){if(t.urlParams?.has("usuarioId")&&t.urlParams?.has("planoTrabalhoId")){let o=yield t.planoTrabalhoDao.getByUsuario(t.urlParams.get("usuarioId"),!0,t.urlParams.get("planoTrabalhoId"));1==o.planos.length&&(t.entity=o.planos[0])}let e=(new Date).getTime();t.items.forEach(o=>{o.plano_trabalho||(o.plano_trabalho=t.entity),t.util.asTimestamp(o.data_inicio)<=e&&e<=t.util.asTimestamp(o.data_fim)&&t.grid.expand(o.id)})})()}addConsolidacao(){var t=this;return(0,d.Z)(function*(){return new Ta({id:t.dao.generateUuid(),plano_trabalho_id:t.entity.id})})()}loadConsolidacao(t,e){var o=this;return(0,d.Z)(function*(){o.form.patchValue({data_inicio:e.data_inicio,data_fim:e.data_fim}),o.cdRef.detectChanges()})()}removeConsolidacao(t){var e=this;return(0,d.Z)(function*(){if(!(yield e.dialog.confirm("Exclui ?","Deseja realmente excluir o item ?")))return!1;try{let n=t;return yield e.dao?.delete(n),e.items.splice(e.items.findIndex(r=>r.id==n.id),1),!0}catch{return!1}})()}saveConsolidacao(t,e){var o=this;return(0,d.Z)(function*(){let n;return o.form.markAllAsTouched(),o.form.valid&&(e.id="NEW"==e.id?o.dao.generateUuid():e.id,e.data_inicio=t.controls.data_inicio.value,e.data_fim=t.controls.data_fim.value,n=yield o.dao?.save(e)),n})()}refreshConsolidacao(t,e){e&&t._metadata?.planoTrabalhoConsolidacaoFormComponent?(t._metadata?.planoTrabalhoConsolidacaoFormComponent).loadConsolidacao(e):this.grid.refreshExpanded(t.id),this.grid.refreshRows()}concluir(t){var e=this;return(0,d.Z)(function*(){e.submitting=!0;try{let o=yield e.dao.concluir(t.id);t.status=o.status,e.refreshConsolidacao(t,o)}catch(o){e.error(o.message||o)}finally{e.submitting=!1}})()}cancelarConclusao(t){var e=this;return(0,d.Z)(function*(){e.submitting=!0;try{let o=yield e.dao.cancelarConclusao(t.id);t.status=o.status,e.refreshConsolidacao(t,o)}catch(o){e.error(o.message||o)}finally{e.submitting=!1}})()}anterior(t){return this.entity.consolidacoes.reduce((e,o)=>this.util.asTimestamp(o.data_inicio)<this.util.asTimestamp(t.data_inicio)&&(!e||this.util.asTimestamp(e.data_inicio)<this.util.asTimestamp(o.data_inicio))?o:e,void 0)}proximo(t){return this.entity.consolidacoes.reduce((e,o)=>this.util.asTimestamp(o.data_fim)>this.util.asTimestamp(t.data_fim)&&(!e||this.util.asTimestamp(e.data_fim)>this.util.asTimestamp(o.data_fim))?o:e,void 0)}isDisabled(t){return t&&"INCLUIDO"!=t.status||"ATIVO"!=this.entity?.status}podeInserir(){return this.auth.hasPermissionTo("MOD_PTR_CSLD_INCL")}dynamicButtons(t){let e=[],o=t;const n=o.plano_trabalho?.usuario_id,r=this.entity.unidade_id,m=o?.avaliacoes.filter(T=>null!=T.recurso).length>0,p=this.auth.usuario.id==n,_={gestor:!1,gestorSubstituto:!1,gestorDelegado:!1},c=this.entity?._metadata.atribuicoesGestorUsuarioLogado||_,f=this.entity?._metadata.atribuicoesGestorUsuario||_,u=this.entity?._metadata.gestorUnidadeSuperior||_,A=!p&&this.auth.hasPermissionTo("MOD_PTR_CSLD_AVAL")&&(this.auth.isIntegrante("AVALIADOR_PLANO_TRABALHO",r)||f.gestor&&(u.gestor||u.gestorSubstituto)||f.gestorSubstituto&&(c.gestor||u.gestor||u.gestorSubstituto)||!f.gestor&&!f.gestorSubstituto&&(c.gestor||c.gestorSubstituto)),Z={hint:"Concluir",icon:"bi bi-check-circle",color:"btn-outline-success",onClick:this.concluir.bind(this)},R={hint:"Cancelar conclus\xe3o",icon:"bi bi-backspace",color:"btn-outline-danger",onClick:this.cancelarConclusao.bind(this)},x={hint:"Avaliar",icon:"bi bi-star",color:"btn-outline-warning",onClick:T=>this.planoTrabalhoService.avaliar(T,this.entity.programa,this.refreshConsolidacao.bind(this))},$={hint:"Reavaliar",icon:"bi bi-star-half",color:"btn-outline-warning",onClick:T=>this.planoTrabalhoService.avaliar(T,this.entity.programa,this.refreshConsolidacao.bind(this))},aa={label:"Recurso",id:"RECORRIDO",icon:"bi bi-journal-medical",color:"btn-outline-warning",onClick:T=>this.planoTrabalhoService.fazerRecurso(T,this.entity.programa,this.refreshConsolidacao.bind(this))},ta={hint:"Cancelar avalia\xe7\xe3o",id:"INCLUIDO",icon:"bi bi-backspace",color:"btn-outline-danger",onClick:T=>this.planoTrabalhoService.cancelarAvaliacao(T,this,this.refreshConsolidacao.bind(this))};return"INCLUIDO"==o.status&&(p||this.auth.hasPermissionTo("MOD_PTR_CSLD_CONCL"))&&e.push(Z),"CONCLUIDO"==o.status&&(p||this.auth.hasPermissionTo("MOD_PTR_CSLD_DES_CONCL"))&&e.push(R),"CONCLUIDO"==o.status&&A&&e.push(x),"AVALIADO"==o.status&&o.avaliacao&&(p&&!m&&this.auth.hasPermissionTo("MOD_PTR_CSLD_REC_AVAL")&&o.avaliacao?.data_avaliacao&&["Inadequado","N\xe3o executado"].includes(o.avaliacao?.nota)&&e.push(aa),A&&(o.avaliacoes.reduce((g,ea)=>ea.data_avaliacao>g.data_avaliacao?ea:g,o.avaliacoes[0]).data_avaliacao>new Date(Date.now()-864e5)&&e.push($),o.avaliacoes.filter(g=>g.recurso).length>0||e.push(ta))),e}mostrarAvaliacao(t){this.planoTrabalhoService.fazerRecurso(t,this.entity.programa,this.refreshConsolidacao.bind(this))}static#a=this.\u0275fac=function(e){return new(e||i)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:i,selectors:[["plano-trabalho-consolidacao-list"]],viewQuery:function(e,o){if(1&e&&a.Gf(C.M,5),2&e){let n;a.iGM(n=a.CRH())&&(o.grid=n.first)}},inputs:{entity:"entity"},features:[a.qOj],decls:24,vars:20,consts:[["editable","",3,"items","form","hasDelete","minHeight","add","hasAdd","hasEdit"],["grid",""],[1,"my-2"],[1,"bi","bi-arrow-down"],["type","expand",3,"icon","align","hint","template","expandTemplate"],["columnConsolidacao",""],["columnExpandedConsolidacao",""],["title","Data in\xedcio",3,"template"],["columnDataInicio",""],["title","Data fim",3,"template"],["columnDataFim",""],["title","Estat\xedsticas/Avalia\xe7\xf5es",3,"template","width"],["columnEstatisticas",""],["title","Status",3,"template"],["columnStatus",""],["type","options",3,"dynamicButtons"],[3,"disabled","entity","planoTrabalho","cdRef"],["consolidacao",""],[3,"align","tipoAvaliacao","nota","click",4,"ngIf"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed",4,"ngIf"],[3,"align","tipoAvaliacao","nota","click"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed"],[1,"one-per-line"],[3,"color","icon","label"],["icon","bi bi-journal-medical","color","warning","label","Recorrido",4,"ngIf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido"]],template:function(e,o){if(1&e&&(a.TgZ(0,"grid",0,1)(2,"h5",2),a._uU(3),a._UZ(4,"i",3),a.qZA(),a.TgZ(5,"columns")(6,"column",4),a.YNc(7,oo,0,0,"ng-template",null,5,a.W1O),a.YNc(9,io,2,4,"ng-template",null,6,a.W1O),a.qZA(),a.TgZ(11,"column",7),a.YNc(12,no,1,1,"ng-template",null,8,a.W1O),a.qZA(),a.TgZ(14,"column",9),a.YNc(15,lo,1,1,"ng-template",null,10,a.W1O),a.qZA(),a.TgZ(17,"column",11),a.YNc(18,co,2,2,"ng-template",null,12,a.W1O),a.qZA(),a.TgZ(20,"column",13),a.YNc(21,mo,3,4,"ng-template",null,14,a.W1O),a.qZA(),a._UZ(23,"column",15),a.qZA()()),2&e){const n=a.MAs(8),r=a.MAs(10),m=a.MAs(13),p=a.MAs(16),_=a.MAs(19),c=a.MAs(22);a.Q6J("items",o.items)("form",o.form)("hasDelete",!0)("minHeight",0)("add",o.addConsolidacao.bind(o))("hasAdd",!1)("hasEdit",!1)("hasDelete",!1),a.xp6(3),a.hij("",o.lex.translate("Consolida\xe7\xf5es")," "),a.xp6(3),a.Q6J("icon",o.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("hint",o.lex.translate("Consolida\xe7\xe3o"))("template",n)("expandTemplate",r),a.xp6(5),a.Q6J("template",m),a.xp6(3),a.Q6J("template",p),a.xp6(3),a.Q6J("template",_)("width",300),a.xp6(3),a.Q6J("template",c),a.xp6(3),a.Q6J("dynamicButtons",o.dynamicButtons.bind(o))}},dependencies:[h.O5,C.M,P.a,U.b,I.N,E.F,X.M,ya]})}return i})();const po=["accordion"];function _o(i,l){1&i&&a._UZ(0,"badge",13),2&i&&a.Q6J("badge",l.$implicit)}function go(i,l){if(1&i&&(a.TgZ(0,"div",1)(1,"div",2),a._uU(2),a.qZA(),a.TgZ(3,"div",3),a._UZ(4,"badge",10)(5,"badge",10)(6,"badge",10)(7,"badge",10),a.qZA(),a.TgZ(8,"div",4),a._uU(9),a.qZA(),a.TgZ(10,"div",5),a.YNc(11,_o,1,1,"badge",11),a.qZA(),a.TgZ(12,"div",5),a._UZ(13,"badge",12),a.qZA()()),2&i){const t=l.item,e=a.oxw();a.xp6(2),a.Oqu("#"+t.numero),a.xp6(2),a.Q6J("icon",e.entityService.getIcon("Usuario"))("label",null==t.usuario?null:t.usuario.nome)("hint",e.lex.translate("Participante")+": "+(null==t.usuario?null:t.usuario.nome)),a.xp6(1),a.Q6J("icon",e.entityService.getIcon("Unidade"))("label",null==t.unidade?null:t.unidade.sigla)("hint",e.lex.translate("Unidade")+": "+(null==t.unidade?null:t.unidade.nome)),a.xp6(1),a.Q6J("icon",e.entityService.getIcon("Programa"))("label",null==t.programa?null:t.programa.nome)("hint",e.lex.translate("Programa")),a.xp6(1),a.Q6J("icon",e.entityService.getIcon("TipoModalidade"))("label",null==t.tipo_modalidade?null:t.tipo_modalidade.nome)("hint",e.lex.translate("Tipo de modalidade")),a.xp6(2),a.hij(" ",e.dao.getDateFormatted(t.data_inicio)+" at\xe9 "+e.dao.getDateFormatted(t.data_fim)," "),a.xp6(2),a.Q6J("ngForOf",e.getPlanoBadges(t)),a.xp6(2),a.Q6J("label",e.lookup.getValue(e.lookup.PLANO_TRABALHO_STATUS,t.status))("icon",e.lookup.getIcon(e.lookup.PLANO_TRABALHO_STATUS,t.status))("color",e.lookup.getColor(e.lookup.PLANO_TRABALHO_STATUS,t.status))}}function ho(i,l){1&i&&a._UZ(0,"plano-trabalho-consolidacao-list",14),2&i&&a.Q6J("entity",l.item)}let fo=(()=>{class i extends S.D{set arquivados(t){this._arquivados!=t&&(this._arquivados=t,this.viewInit&&this.loadData(this.entity,this.form))}get arquivados(){return this._arquivados}constructor(t){super(t),this.injector=t,this.selectedIndex=-1,this.planos=[],this._arquivados=!1,this.dao=t.get(w.t)}ngAfterViewInit(){var t=this;super.ngAfterViewInit(),(0,d.Z)(function*(){yield t.loadData(t.entity,t.form)})()}loadData(t,e){var o=this;return(0,d.Z)(function*(){o.accordion.loading=!0;try{let r=yield o.dao.getByUsuario(o.usuarioId,o.arquivados),m=(new Date).getTime();o.planos=r.planos;for(var n=0;n<o.planos.length;n++)o.util.asTimestamp(o.planos[n].data_inicio)<=m&&m<=o.util.asTimestamp(o.planos[n].data_fim)&&["ATIVO","CONCLUIDO"].includes(o.planos[n].status)&&(o.selectedIndex=n)}finally{o.accordion.loading=!1,o.cdRef.detectChanges()}})()}getPlanoBadges(t){let e=[],o=t.consolidacoes.filter(r=>"CONCLUIDO"==r.status),n=t.consolidacoes.filter(r=>"AVALIADO"==r.status);if(o.length){const r=this.lookup.getLookup(this.lookup.CONSOLIDACAO_STATUS,"CONCLUIDO");e.push({icon:r?.icon,label:r?.value,color:r?.color,textValue:o.length.toString()})}if(n.length){const r=this.lookup.getLookup(this.lookup.CONSOLIDACAO_STATUS,"AVALIADO");e.push({icon:r?.icon,label:r?.value,color:r?.color,textValue:n.length.toString()})}return JSON.stringify(t._metadata?.badges)!=this.JSON.stringify(e)&&(t._metadata=Object.assign(t._metadata||{},{badges:e})),t._metadata.badges}static#a=this.\u0275fac=function(e){return new(e||i)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:i,selectors:[["plano-trabalho-list-accordeon"]],viewQuery:function(e,o){if(1&e&&a.Gf(po,5),2&e){let n;a.iGM(n=a.CRH())&&(o.accordion=n.first)}},inputs:{usuarioId:"usuarioId",arquivados:"arquivados"},features:[a.qOj],decls:17,vars:8,consts:[[1,"p-3","bg-body-secondary","mb-3"],[1,"row","w-100"],[1,"col-md-1"],[1,"col-md-4"],[1,"col-md-3"],[1,"col-md-2"],[3,"items","selectedIndex","titleTemplate","template"],["accordion",""],["planoTrabalhoSectionTitle",""],["planoTrabalhoSection",""],["color","light",3,"icon","label","hint"],[3,"badge",4,"ngFor","ngForOf"],[3,"label","icon","color"],[3,"badge"],[3,"entity"]],template:function(e,o){if(1&e&&(a.TgZ(0,"div",0)(1,"div",1)(2,"div",2),a._uU(3,"#ID"),a.qZA(),a.TgZ(4,"div",3),a._uU(5),a.qZA(),a.TgZ(6,"div",4),a._uU(7,"Vig\xeancia"),a.qZA(),a._UZ(8,"div",5),a.TgZ(9,"div",5),a._uU(10,"Status"),a.qZA()()(),a.TgZ(11,"accordion",6,7),a.YNc(13,go,14,18,"ng-template",null,8,a.W1O),a.YNc(15,ho,1,1,"ng-template",null,9,a.W1O),a.qZA()),2&e){const n=a.MAs(14),r=a.MAs(16);a.xp6(5),a.HOy("",o.lex.translate("Participante"),"/",o.lex.translate("Unidade"),"/",o.lex.translate("Programa"),"/",o.lex.translate("Tipo de modalidade"),""),a.xp6(6),a.Q6J("items",o.planos)("selectedIndex",o.selectedIndex)("titleTemplate",n)("template",r)}},dependencies:[h.sg,E.F,oe.Z,xa]})}return i})();function bo(i,l){1&i&&(a.TgZ(0,"div",15)(1,"div",16),a._UZ(2,"span",17),a.qZA()())}function vo(i,l){if(1&i&&(a.TgZ(0,"div",21)(1,"div",22),a._UZ(2,"profile-picture",23),a.qZA(),a.TgZ(3,"div",24)(4,"strong"),a._uU(5),a.qZA(),a._UZ(6,"br"),a.TgZ(7,"small"),a._uU(8),a.qZA()()()),2&i){const t=l.data;a.xp6(2),a.Q6J("url",t.url_foto)("size",40)("hint",t.nome),a.xp6(3),a.Oqu(t.nome||""),a.xp6(3),a.Oqu(t.apelido||"")}}function To(i,l){1&i&&a._UZ(0,"plano-trabalho-list-accordeon",25),2&i&&a.Q6J("usuarioId",l.data.id)}function Co(i,l){if(1&i&&(a.TgZ(0,"collapse-card",18),a.YNc(1,vo,9,5,"ng-template",null,19,a.W1O),a.YNc(3,To,1,1,"ng-template",null,20,a.W1O),a.qZA()),2&i){const t=l.$implicit,e=a.MAs(2),o=a.MAs(4);a.Q6J("data",t)("titleTemplate",e)("template",o)}}function Ao(i,l){if(1&i&&(a.TgZ(0,"filter",7)(1,"div",8),a._UZ(2,"input-search",9,10),a.qZA()(),a.TgZ(4,"div",11)(5,"h5"),a._uU(6),a.qZA(),a.TgZ(7,"h4"),a._uU(8),a._UZ(9,"i",12),a.qZA()(),a.YNc(10,bo,3,0,"div",13),a.YNc(11,Co,5,3,"collapse-card",14)),2&i){const t=a.MAs(3),e=a.oxw(2);a.Q6J("form",e.filter)("filter",e.filterWhere)("collapsed",!1),a.xp6(2),a.Q6J("size",12)("control",e.filter.controls.unidade_id)("dao",e.unidadeDao),a.xp6(4),a.lnq("",e.lex.translate("Unidade")," selecionada: ",null==t||null==t.selectedItem?null:t.selectedItem.entity.sigla," - ",null==t||null==t.selectedItem?null:t.selectedItem.entity.nome,""),a.xp6(2),a.hij("",e.lex.translate("Participantes")," "),a.xp6(2),a.Q6J("ngIf",e.loading),a.xp6(1),a.Q6J("ngForOf",e.usuarios)}}function yo(i,l){if(1&i&&(a.TgZ(0,"tab",5),a.YNc(1,Ao,12,12,"ng-template",null,6,a.W1O),a.qZA()),2&i){const t=a.MAs(2),e=a.oxw();a.Q6J("icon",e.entityService.getIcon("Unidade"))("label",e.lex.translate("Unidade"))("template",t)}}function xo(i,l){if(1&i&&(a.TgZ(0,"div",26)(1,"h5",27),a._uU(2),a._UZ(3,"i",12),a.qZA(),a._UZ(4,"separator",28),a.qZA(),a._UZ(5,"plano-trabalho-list-accordeon",29)),2&i){const t=a.oxw();a.xp6(2),a.hij("",t.lex.translate("Planos de Trabalho")," "),a.xp6(2),a.Q6J("control",t.form.controls.arquivados)("title","Mostrar "+t.lex.translate("Planos de trabalho")+" arquivados?"),a.xp6(1),a.Q6J("usuarioId",t.auth.usuario.id)("arquivados",t.form.controls.arquivados.value)}}let Eo=(()=>{class i extends S.D{constructor(t){super(t),this.injector=t,this.usuarios=[],this.loadingUnidade=!1,this.filterWhere=e=>{this.loadUsuarios(e.value.unidade_id)},this.unidadeDao=t.get(N.J),this.form=this.fh.FormBuilder({arquivados:{default:!1}}),this.filter=this.fh.FormBuilder({unidade_id:{default:!1}})}ngAfterViewInit(){var t=this;super.ngAfterViewInit(),this.tabs.active=this.queryParams?.tab||"USUARIO",this.tabs.title=this.lex.translate("Consolida\xe7\xf5es"),(0,d.Z)(function*(){yield t.loadData(t.entity,t.form)})()}loadData(t,e){var o=this;return(0,d.Z)(function*(){o.unidade=o.auth.unidadeGestor(),o.filter.controls.unidade_id.setValue(o.unidade?.id||o.auth.lotacao||null),o.unidade&&(yield o.loadUsuarios(o.unidade.id))})()}loadUsuarios(t){var e=this;return(0,d.Z)(function*(){e.usuarios=[],e.loadingUnidade=!0,e.loading=!0,e.cdRef.detectChanges();try{e.usuarios=yield e.unidadeDao.lotados(t)}finally{e.loading=!1,e.loadingUnidade=!1,e.cdRef.detectChanges()}})()}static#a=this.\u0275fac=function(e){return new(e||i)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:i,selectors:[["app-plano-trabalho-consolidacao"]],viewQuery:function(e,o){if(1&e&&(a.Gf(F.n,5),a.Gf(y.V,5)),2&e){let n;a.iGM(n=a.CRH())&&(o.tabs=n.first),a.iGM(n=a.CRH())&&(o.unidadeSelecionada=n.first)}},features:[a.qOj],decls:6,vars:5,consts:[["right","",3,"title"],["tabs",""],["key","UNIDADE",3,"icon","label","template",4,"ngIf"],["key","USUARIO",3,"icon","label","template"],["tabUsuario",""],["key","UNIDADE",3,"icon","label","template"],["tabUnidade",""],[3,"form","filter","collapsed"],[1,"row"],["label","Selecione a unidade","controlName","unidade_id",3,"size","control","dao"],["unidadeSelecionada",""],[1,"p-3","mb-3","bg-body-secondary"],[1,"bi","bi-arrow-down"],["class","d-flex justify-content-center my-2",4,"ngIf"],[3,"data","titleTemplate","template",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-center","my-2"],["role","status",1,"spinner-border"],[1,"visually-hidden"],[3,"data","titleTemplate","template"],["usuarioCardTitle",""],["usuarioCard",""],[1,"d-flex"],[1,"ms-3"],[3,"url","size","hint"],[1,"flex-fill","ms-3"],[3,"usuarioId"],[1,"d-flex","justify-content-between"],[1,"mt-2"],[3,"control","title"],[3,"usuarioId","arquivados"]],template:function(e,o){if(1&e&&(a.TgZ(0,"tabs",0,1),a.YNc(2,yo,3,3,"tab",2),a.TgZ(3,"tab",3),a.YNc(4,xo,6,5,"ng-template",null,4,a.W1O),a.qZA()()),2&e){const n=a.MAs(5);a.Q6J("title",o.isModal?"":o.title),a.xp6(2),a.Q6J("ngIf",o.unidade),a.xp6(1),a.Q6J("icon",o.entityService.getIcon("Usuario"))("label",o.lex.translate("Usu\xe1rio"))("template",n)}},dependencies:[h.sg,h.O5,K.z,y.V,F.n,Y.i,I.N,ba.q,ee,fo]})}return i})();var Ea=s(38),Zo=s(929);function Do(i,l){if(1&i&&(a.TgZ(0,"div",12)(1,"div",13)(2,"strong"),a._uU(3),a.qZA(),a._UZ(4,"br"),a.TgZ(5,"small"),a._uU(6),a.qZA()()()),2&i){const t=l.row;a.xp6(3),a.Oqu(t.avaliador.nome||""),a.xp6(3),a.Oqu(t.avaliador.apelido||"")}}function Oo(i,l){if(1&i&&a._UZ(0,"badge",17),2&i){const t=l.$implicit,e=a.oxw(3);a.Q6J("icon",e.entityService.getIcon("TipoJustificativa"))("label",t.value)}}function Io(i,l){if(1&i&&(a._UZ(0,"avaliar-nota-badge",14)(1,"br"),a.TgZ(2,"small"),a._uU(3),a.qZA(),a.TgZ(4,"div",15),a.YNc(5,Oo,1,2,"badge",16),a.qZA()),2&i){const t=l.row;a.Q6J("align","left")("tipoAvaliacao",t.tipo_avaliacao)("nota",t.nota),a.xp6(3),a.Oqu(t.justificativa||""),a.xp6(2),a.Q6J("ngForOf",t.justificativas)}}function Po(i,l){if(1&i&&(a.TgZ(0,"small"),a._uU(1),a.qZA()),2&i){const t=l.row;a.xp6(1),a.Oqu(t.recurso||"")}}function Uo(i,l){1&i&&a._UZ(0,"badge",19)}function wo(i,l){if(1&i&&(a.TgZ(0,"div",15),a.YNc(1,Uo,1,0,"badge",18),a.qZA()),2&i){const t=l.row;a.xp6(1),a.Q6J("ngIf",null==t.recurso?null:t.recurso.length)}}function No(i,l){if(1&i&&(a.ynx(0),a.TgZ(1,"grid",1,2)(3,"columns"),a._UZ(4,"column",3),a.TgZ(5,"column",4),a.YNc(6,Do,7,2,"ng-template",null,5,a.W1O),a.qZA(),a.TgZ(8,"column",6),a.YNc(9,Io,6,5,"ng-template",null,7,a.W1O),a.qZA(),a.TgZ(11,"column",8),a.YNc(12,Po,2,1,"ng-template",null,9,a.W1O),a.qZA(),a.TgZ(14,"column",10),a.YNc(15,wo,2,1,"ng-template",null,11,a.W1O),a.qZA()()(),a.BQk()),2&i){const t=a.MAs(7),e=a.MAs(10),o=a.MAs(13),n=a.MAs(16),r=a.oxw();a.xp6(1),a.Q6J("items",r.consolidacao.avaliacoes)("minHeight",0),a.xp6(4),a.Q6J("template",t),a.xp6(3),a.Q6J("title","Nota\nJustificativas")("template",e),a.xp6(3),a.Q6J("template",o),a.xp6(3),a.Q6J("template",n)}}let Jo=(()=>{class i extends Zo._{constructor(t){super(t),this.injector=t,this.joinConsolidacao=["avaliacoes.tipo_avaliacao","avaliacoes.avaliador"],this.consolidacaoDao=t.get(V.E)}ngOnInit(){super.ngOnInit(),this.buscaConsolidacao()}buscaConsolidacao(){var t=this;return(0,d.Z)(function*(){t.consolidacao=yield t.consolidacaoDao.getById(t.urlParams.get("consolidacaoId"),t.joinConsolidacao)})()}static#a=this.\u0275fac=function(e){return new(e||i)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:i,selectors:[["visualizar-avaliacao"]],features:[a.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[3,"items","minHeight"],["gridEntregas",""],["title","Data","type","datetime","field","data_avaliacao"],["title","Avaliador",3,"template"],["columnAvaliador",""],[3,"title","template"],["columnNotaJustificativa",""],["title","Recurso",3,"template"],["columnRecurso",""],["title","Status",3,"template"],["columnStatus",""],[1,"avaliador"],[1,"avaliador-nome"],[3,"align","tipoAvaliacao","nota"],[1,"one-per-line"],[3,"icon","label",4,"ngFor","ngForOf"],[3,"icon","label"],["icon","bi bi-journal-medical","color","warning","label","Recorrido",4,"ngIf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido"]],template:function(e,o){1&e&&a.YNc(0,No,17,7,"ng-container",0),2&e&&a.Q6J("ngIf",o.consolidacao)},dependencies:[h.sg,h.O5,C.M,P.a,U.b,E.F,X.M]})}return i})();var Qo=s(8509),So=s(1313),Za=s(5512),Da=s(2704);function Ro(i,l){if(1&i&&(a.TgZ(0,"div",31)(1,"div",32),a._UZ(2,"profile-picture",33),a.qZA(),a.TgZ(3,"div",34)(4,"strong"),a._uU(5),a.qZA(),a._UZ(6,"br")(7,"badge",35),a.qZA()()),2&i){const t=l.separator,e=a.oxw(2);let o,n,r,m;a.xp6(2),a.Q6J("url",null==(o=e.usuarioSeparator(t))?null:o.url_foto)("size",40)("hint",null==(n=e.usuarioSeparator(t))?null:n.nome),a.xp6(3),a.Oqu((null==(r=e.usuarioSeparator(t))?null:r.nome)||"Desconhecido"),a.xp6(2),a.Q6J("icon",e.entityService.getIcon("Unidade"))("label",(null==(m=e.unidadeSeparator(t))?null:m.sigla)||"Desconhecido")}}function Mo(i,l){1&i&&a._UZ(0,"toolbar")}function qo(i,l){}function Fo(i,l){if(1&i&&a._UZ(0,"plano-trabalho-consolidacao-form",36,37),2&i){const t=l.row,e=a.oxw(2);a.Q6J("disabled",!0)("entity",t)("planoTrabalho",t.plano_trabalho)("cdRef",e.cdRef)}}function Vo(i,l){if(1&i&&(a._uU(0),a._UZ(1,"badge",38)(2,"badge",39)(3,"badge",40)),2&i){const t=l.row,e=a.oxw(2);a.hij(" #",null==t.plano_trabalho?null:t.plano_trabalho.numero," "),a.xp6(1),a.Q6J("textValue",e.util.getDateFormatted(null==t.plano_trabalho?null:t.plano_trabalho.data_inicio)),a.xp6(1),a.Q6J("textValue",e.util.getDateFormatted(null==t.plano_trabalho?null:t.plano_trabalho.data_fim)),a.xp6(1),a.Q6J("icon",e.entityService.getIcon("TipoModalidade"))("label",null==t.plano_trabalho||null==t.plano_trabalho.tipo_modalidade?null:t.plano_trabalho.tipo_modalidade.nome)("hint",e.lex.translate("Tipo de modalidade"))}}function Lo(i,l){if(1&i&&a._uU(0),2&i){const t=l.row,e=a.oxw(2);a.hij(" ",e.util.getDateFormatted(t.data_inicio)," ")}}function Go(i,l){if(1&i&&(a.TgZ(0,"strong"),a._uU(1),a.qZA()),2&i){const t=l.row,e=a.oxw(2);a.xp6(1),a.Oqu(e.util.getDateFormatted(t.data_fim))}}function zo(i,l){if(1&i&&a._UZ(0,"avaliar-nota-badge",43),2&i){const t=a.oxw().row;a.Q6J("align","left")("tipoAvaliacao",t.avaliacao.tipo_avaliacao)("nota",t.avaliacao.nota)}}function Yo(i,l){if(1&i&&(a.TgZ(0,"separator",44)(1,"small"),a._uU(2),a.qZA()()),2&i){const t=a.oxw().row;a.Q6J("collapsed",!1),a.xp6(2),a.Oqu(t.avaliacao.recurso)}}function Ho(i,l){if(1&i&&(a.YNc(0,zo,1,3,"avaliar-nota-badge",41),a.YNc(1,Yo,3,2,"separator",42)),2&i){const t=l.row;a.Q6J("ngIf",t.avaliacao),a.xp6(1),a.Q6J("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}function Bo(i,l){1&i&&a._UZ(0,"badge",48)}function ko(i,l){if(1&i&&(a.TgZ(0,"div",45),a._UZ(1,"badge",46),a.YNc(2,Bo,1,0,"badge",47),a.qZA()),2&i){const t=l.row,e=a.oxw(2);a.xp6(1),a.Q6J("color",e.lookup.getColor(e.lookup.CONSOLIDACAO_STATUS,t.status))("icon",e.lookup.getIcon(e.lookup.CONSOLIDACAO_STATUS,t.status))("label",e.lookup.getValue(e.lookup.CONSOLIDACAO_STATUS,t.status)),a.xp6(1),a.Q6J("ngIf",null==t.avaliacao||null==t.avaliacao.recurso?null:t.avaliacao.recurso.length)}}function Wo(i,l){if(1&i){const t=a.EpF();a.TgZ(0,"grid",3),a.YNc(1,Ro,8,6,"ng-template",null,4,a.W1O),a.YNc(3,Mo,1,0,"toolbar",5),a.TgZ(4,"filter",6)(5,"div",7),a._UZ(6,"input-search",8,9),a.TgZ(8,"input-search",10,11),a.NdJ("change",function(o){a.CHM(t);const n=a.oxw();return a.KtG(n.onUnidadeChange(o))}),a.qZA(),a._UZ(10,"input-switch",12,13)(12,"input-switch",14,15),a.qZA()(),a.TgZ(14,"columns")(15,"column",16),a.YNc(16,qo,0,0,"ng-template",null,17,a.W1O),a.YNc(18,Fo,2,4,"ng-template",null,18,a.W1O),a.qZA(),a.TgZ(20,"column",19),a.YNc(21,Vo,4,6,"ng-template",null,20,a.W1O),a.qZA(),a.TgZ(23,"column",21),a.YNc(24,Lo,1,1,"ng-template",null,22,a.W1O),a.qZA(),a.TgZ(26,"column",23),a.YNc(27,Go,2,1,"ng-template",null,24,a.W1O),a.qZA(),a.TgZ(29,"column",25),a.YNc(30,Ho,2,2,"ng-template",null,26,a.W1O),a.qZA(),a.TgZ(32,"column",27),a.YNc(33,ko,3,4,"ng-template",null,28,a.W1O),a.qZA(),a._UZ(35,"column",29),a.qZA(),a._UZ(36,"pagination",30),a.qZA()}if(2&i){const t=a.MAs(2),e=a.MAs(17),o=a.MAs(19),n=a.MAs(22),r=a.MAs(25),m=a.MAs(28),p=a.MAs(31),_=a.MAs(34),c=a.oxw();a.Q6J("dao",c.dao)("orderBy",c.orderBy)("groupBy",c.groupBy)("join",c.join)("init",c.initGrid.bind(c))("hasAdd",!1)("hasEdit",!1)("loadList",c.onGridLoad.bind(c))("groupTemplate",t),a.xp6(3),a.Q6J("ngIf",!c.selectable),a.xp6(1),a.Q6J("form",c.filter)("where",c.filterWhere)("submit",c.filterSubmit.bind(c))("collapseChange",c.filterCollapseChange.bind(c))("collapsed",c.filterCollapsed)("deleted",c.auth.hasPermissionTo("MOD_AUDIT_DEL")),a.xp6(2),a.Q6J("size",5)("control",c.filter.controls.usuario_id)("dao",c.usuarioDao),a.xp6(2),a.Q6J("size",5)("control",c.filter.controls.unidade_id)("dao",c.unidadeDao),a.xp6(2),a.Q6J("size",1)("disabled",c.canFilterSubordinadas)("control",c.filter.controls.unidades_subordinadas),a.xp6(2),a.Q6J("size",1)("control",c.filter.controls.incluir_arquivados),a.xp6(3),a.Q6J("icon",c.entityService.getIcon("PlanoTrabalhoConsolidacao"))("align","center")("hint",c.lex.translate("Consolida\xe7\xe3o"))("template",e)("expandTemplate",o),a.xp6(5),a.Q6J("title","Plano de trabalho/Vig\xeancia/Modalidade")("template",n),a.xp6(3),a.Q6J("template",r),a.xp6(3),a.Q6J("template",m),a.xp6(3),a.Q6J("title","Estat\xedsticas\nAvalia\xe7\xf5es")("template",p)("width",300),a.xp6(3),a.Q6J("template",_),a.xp6(3),a.Q6J("dynamicButtons",c.dynamicButtons.bind(c)),a.xp6(1),a.Q6J("rows",c.rowsLimit)}}const Ko=[{path:"",component:fa.H,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Planos de Trabalho"}},{path:"new",component:j,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Inclus\xe3o de Plano de Trabalho",modal:!0}},{path:"termo",component:Ma,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Termo de ades\xe3o",modal:!0}},{path:"consolidacao/avaliacao",component:(()=>{class i extends Qo.E{constructor(t){super(t,Ta,V.E),this.injector=t,this.avaliacoes=[],this.planos_trabalhos=[],this.programas=[],this.avaliacao=new So.g,this.consolidacaoId=[],this.joinAvaliacao=["avaliador","entregas_checklist","tipo_avaliacao.notas"],this.filterWhere=e=>{let o=[],n=e.value;return o.push(["status","in",["CONCLUIDO","AVALIADO"]]),n.usuario_id?.length&&o.push(["plano_trabalho.usuario.id","==",n.usuario_id]),n.unidade_id?.length&&o.push(["plano_trabalho.unidade.id","==",n.unidade_id]),n.unidades_subordinadas&&o.push(["unidades_subordinadas","==",!0]),n.incluir_arquivados&&o.push(["incluir_arquivados","==",!0]),o},this.filterWhereHistorico=e=>{let o=[],n=e.value;return o.push(["status","in",["AVALIADO"]]),n.usuario_id?.length&&o.push(["plano_trabalho.usuario.id","==",n.usuario_id]),n.unidade_id?.length&&o.push(["plano_trabalho.unidade.id","==",n.unidade_id]),n.unidades_subordinadas&&o.push(["unidades_subordinadas","==",!0]),n.incluir_arquivados&&o.push(["incluir_arquivados","==",!0]),o},this.unidadeService=t.get(H.Z),this.join=["avaliacoes:id,recurso","avaliacao","plano_trabalho:id"],this.extraJoin=["avaliacao.tipoAvaliacao.notas","planoTrabalho.unidade:id,sigla,nome","planoTrabalho.unidade.gestor:id,unidade_id,usuario_id","planoTrabalho.unidade.unidadePai.gestoresSubstitutos:id,unidade_id,usuario_id","planoTrabalho.unidade.unidadePai.gestor:id,unidade_id,usuario_id","planoTrabalho.unidade.gestoresSubstitutos:id,unidade_id,usuario_id","planoTrabalho.tipoModalidade:id,nome","planoTrabalho.usuario:id,nome,apelido,foto_perfil,url_foto"],this.groupBy=[{field:"plano_trabalho.unidade.sigla",label:this.lex.translate("Unidade")},{field:"plano_trabalho.unidade.id",label:"Unidade Id"},{field:"plano_trabalho.usuario.nome",label:this.lex.translate("Participante")},{field:"plano_trabalho.usuario.id",label:"Usu\xe1rio Id"}],this.usuarioDao=t.get(G.q),this.unidadeDao=t.get(N.J),this.avaliacaoDao=t.get(Ca.w),this.planoTrabalhoService=t.get(Q.p),this.title="Avalia\xe7\xf5es "+this.lex.translate("das Consolida\xe7\xf5es"),this.code="MOD_PTR_CSLD_AVAL",this.filter=this.fh.FormBuilder({usuario_id:{default:""},unidade_id:{default:""},unidades_subordinadas:{default:!1},incluir_arquivados:{default:!1}}),this.rowsLimit=10,this.addOption(this.OPTION_INFORMACOES),this.addOption(this.OPTION_LOGS,"MOD_AUDIT_LOG")}ngOnInit(){super.ngOnInit(),this.filter.controls.unidade_id.setValue(this.auth.unidadeGestor()?.id||this.auth.lotacao||null)}get canFilterSubordinadas(){return this.unidadeService.isGestorUnidade(this.filter.controls.unidade_id.value)?void 0:"true"}usuarioSeparator(t){let e=t.group[3].value;return t.metadata=t.metadata||{},t.metadata.usuario=t.metadata.usuario||this.planos_trabalhos?.find(o=>o.usuario_id==e)?.usuario,t.metadata.usuario}unidadeSeparator(t){let e=t.group[1].value;return t.metadata=t.metadata||{},t.metadata.unidade=t.metadata.unidade||this.planos_trabalhos?.find(o=>o.unidade_id==e)?.unidade,t.metadata.unidade}onUnidadeChange(t){this.unidadeService.isGestorUnidade(this.filter.controls.unidade_id.value)||this.filter.controls.unidades_subordinadas.setValue(!1)}onGridLoad(t){this.extra=(this.grid?.query||this.query).extra,this.extra&&(this.planos_trabalhos=(this.planos_trabalhos||[]).concat(this.extra?.planos_trabalhos||[]),this.programas=(this.programas||[]).concat(this.extra?.programas||[]),this.planos_trabalhos.forEach(e=>{let o=e;o.programa=this.programas?.find(n=>n.id==o.programa_id)}),t?.forEach(e=>{let o=e;o.plano_trabalho=this.planos_trabalhos?.find(n=>n.id==o.plano_trabalho_id),o.avaliacao&&(o.avaliacao.tipo_avaliacao=this.extra?.tipos_avaliacoes?.find(n=>n.id==o.avaliacao.tipo_avaliacao_id))}))}refreshConsolidacao(t){var e=this;(0,d.Z)(function*(){yield e.grid.query.refreshId(t.id,e.extraJoin),e.grid.refreshRows()})()}dynamicButtons(t){let e=[],o=t,n=o.plano_trabalho.programa,r=!1;const m=o.plano_trabalho.usuario_id,p=o.plano_trabalho.unidade_id,_=o.plano_trabalho.unidade,c=m==this.auth.usuario?.id,f=_?.gestor?.usuario_id==m,u=_?.gestores_substitutos.map(g=>g.usuario_id).includes(m),A=_?.gestores_delegados.map(g=>g.usuario_id).includes(m),Z=!f&&!u&&!A,R=this.auth.hasPermissionTo("MOD_PTR_CSLD_AVAL"),x=!!o.plano_trabalho.unidade&&this.unidadeService.isGestorUnidadeSuperior(o.plano_trabalho.unidade);f?r=x:u?r=x||this.unidadeService.isGestorTitularUnidade(p):A?r=x||this.unidadeService.isGestorUnidade(p,!1):Z&&(r=x||this.unidadeService.isGestorUnidade(p));const $={hint:"Visualizar",icon:"bi bi-eye",color:"btn-outline-primary",onClick:g=>this.planoTrabalhoService.visualizarAvaliacao(g)},ta={hint:"Reavaliar",icon:"bi bi-star-half",color:"btn-outline-warning",onClick:g=>this.planoTrabalhoService.avaliar(g,n,this.refreshConsolidacao.bind(this))},T={label:"Recurso",id:"RECORRIDO",icon:"bi bi-journal-medical",color:"btn-outline-warning",onClick:g=>this.planoTrabalhoService.fazerRecurso(g,n,this.refreshConsolidacao.bind(this))},Oa={hint:"Cancelar avalia\xe7\xe3o",id:"INCLUIDO",icon:"bi bi-backspace",color:"btn-outline-danger",onClick:g=>this.planoTrabalhoService.cancelarAvaliacao(g,this,this.refreshConsolidacao.bind(this))};return"CONCLUIDO"==o.status&&!c&&r&&R&&e.push({hint:"Avaliar",icon:"bi bi-star",color:"btn-outline-info",onClick:g=>this.planoTrabalhoService.avaliar(g,n,this.refreshConsolidacao.bind(this))}),"AVALIADO"==o.status&&o.avaliacao&&(e.push($),c&&this.auth.hasPermissionTo("MOD_PTR_CSLD_REC_AVAL")&&o.avaliacao?.data_avaliacao&&["Inadequado","N\xe3o executado"].includes(o.avaliacao?.nota)&&e.push(T),r&&(o.avaliacoes.reduce((L,Ia)=>Ia.data_avaliacao>L.data_avaliacao?Ia:L,o.avaliacoes[0]).data_avaliacao>new Date(Date.now()-864e5)&&e.push(ta),o.avaliacoes.filter(L=>L.recurso).length>0||e.push(Oa))),e}onSelectTab(t){var e=this;return(0,d.Z)(function*(){e.viewInit&&e.saveUsuarioConfig({active_tab:t.key})})()}initGrid(t){t.queryInit()}getAvaliacoes(t){return this.avaliacoes.filter(e=>e.plano_trabalho_consolidacao_id==t.id)}loadData(){var t=this;return(0,d.Z)(function*(){t.loading=!0;try{t.avaliacoes=yield t.avaliacaoDao.query({where:[["plano_trabalho_consolidacao_id","in",t.consolidacaoId]],join:t.joinAvaliacao,orderBy:[["data_avaliacao","desc"]]}).asPromise(),t.avaliacao=t.avaliacoes[0]||t.avaliacao}finally{t.loading=!1}})()}onGridLoadHistorico(t){this.extra=(this.grid?.query||this.query).extra,(this.extra?.planos_trabalhos||[]).forEach(o=>{let n=o;n.programa=this.extra?.programas?.find(r=>r.id==n.programa_id)}),t?.forEach(o=>{this.consolidacaoId?.push(o.id);let n=o;n.plano_trabalho=this.extra?.planos_trabalhos?.find(r=>r.id==n.plano_trabalho_id),n.avaliacao&&(n.avaliacao.tipo_avaliacao=this.extra?.tipos_avaliacoes?.find(r=>r.id==n.avaliacao.tipo_avaliacao_id))}),this.loadData()}getNota(t){return t.tipo_avaliacao.notas.find(e=>e.codigo==t.nota)}static#a=this.\u0275fac=function(e){return new(e||i)(a.Y36(a.zs3))};static#t=this.\u0275cmp=a.Xpm({type:i,selectors:[["app-plano-trabalho-consolidacao-avaliacao"]],viewQuery:function(e,o){if(1&e&&a.Gf(C.M,5),2&e){let n;a.iGM(n=a.CRH())&&(o.grid=n.first)}},features:[a.qOj],decls:4,vars:4,consts:[["right","",3,"title","select"],["key","CONSOLIDACOES","icon","bi bi-clipboard-check",3,"label","template"],["consolidacoes",""],[3,"dao","orderBy","groupBy","join","init","hasAdd","hasEdit","loadList","groupTemplate"],["groupUnidadeUsuario",""],[4,"ngIf"],[3,"form","where","submit","collapseChange","collapsed","deleted"],[1,"row"],["controlName","usuario_id",3,"size","control","dao"],["usuario",""],["controlName","unidade_id",3,"size","control","dao","change"],["unidade",""],["label","Sub.","controlName","unidades_subordinadas","labelInfo","Incluir as unidades subordinadas",3,"size","disabled","control"],["subordinadas",""],["label","Arq.","controlName","incluir_arquivados","labelInfo","Incluir os planos de trabalhos arquivados",3,"size","control"],["arquivadas",""],["type","expand",3,"icon","align","hint","template","expandTemplate"],["columnConsolidacao",""],["columnExpandedConsolidacao",""],[3,"title","template"],["columnPlanoTrabalho",""],["title","Data in\xedcio",3,"template"],["columnDataInicio",""],["title","Data fim",3,"template"],["columnDataFim",""],[3,"title","template","width"],["columnEstatisticas",""],["title","Status",3,"template"],["columnStatus",""],["type","options",3,"dynamicButtons"],[3,"rows"],[1,"d-flex"],[1,"ms-3"],[3,"url","size","hint"],[1,"flex-fill","ms-3"],["color","primary",3,"icon","label"],[3,"disabled","entity","planoTrabalho","cdRef"],["consolidacao",""],["label","In\xedcio","color","light","icon","bi bi-calendar2",3,"textValue"],["label","T\xe9rmino","color","light","icon","bi bi-calendar2-check",3,"textValue"],["color","light",3,"icon","label","hint"],[3,"align","tipoAvaliacao","nota",4,"ngIf"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed",4,"ngIf"],[3,"align","tipoAvaliacao","nota"],["title","Recurso da avalia\xe7\xe3o","collapse","",3,"collapsed"],[1,"one-per-line"],[3,"color","icon","label"],["icon","bi bi-journal-medical","color","warning","label","Recorrido",4,"ngIf"],["icon","bi bi-journal-medical","color","warning","label","Recorrido"]],template:function(e,o){if(1&e&&(a.TgZ(0,"tabs",0)(1,"tab",1),a.YNc(2,Wo,37,42,"ng-template",null,2,a.W1O),a.qZA()()),2&e){const n=a.MAs(3);a.Q6J("title",o.isModal?"":o.title)("select",o.onSelectTab.bind(o)),a.xp6(1),a.Q6J("label",o.lex.translate("Consolida\xe7\xf5es"))("template",n)}},dependencies:[h.O5,C.M,P.a,U.b,K.z,Za.n,Da.Q,J.a,y.V,F.n,Y.i,I.N,E.F,ba.q,X.M,ya]})}return i})(),canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Avalia\xe7\xe3o das Consolida\xe7\xf5es do Plano de Trabalho"}},{path:"consolidacao/:consolidacaoId/avaliar",component:Ea.w,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Avaliar Consolida\xe7\xe3o do Plano de Trabalho"}},{path:"consolidacao/:consolidacaoId/recurso",component:Ea.w,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Recurso da Avalia\xe7\xe3o da Consolida\xe7\xe3o do Plano de Trabalho"}},{path:"consolidacao/:consolidacaoId/verAvaliacoes",component:Jo,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Visualizar avalia\xe7\xf5es da Consolida\xe7\xe3o do Plano de Trabalho"}},{path:"consolidacao/:usuarioId/:planoTrabalhoId",component:xa,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Consolida\xe7\xf5es do Plano de Trabalho"}},{path:"consolidacao",component:Eo,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Consolida\xe7\xf5es"}},{path:":id/edit",component:j,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Edi\xe7\xe3o de Plano de Trabalho",modal:!0}},{path:":id/consult",component:j,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Consulta a Plano de Trabalho",modal:!0}},{path:"entrega-list",component:W,canActivate:[b.a],resolve:{config:v.o},runGuardsAndResolvers:"always",data:{title:"Lista de Entregas do Plano de Trabalho",modal:!0}}];let Xo=(()=>{class i{static#a=this.\u0275fac=function(e){return new(e||i)};static#t=this.\u0275mod=a.oAB({type:i});static#e=this.\u0275inj=a.cJS({imports:[ia.Bz.forChild(Ko),ia.Bz]})}return i})();var $o=s(2662),ai=s(2133),ti=s(2864),ei=s(9013),oi=s(8252),ii=s(1915);let ni=(()=>{class i{static#a=this.\u0275fac=function(e){return new(e||i)};static#t=this.\u0275mod=a.oAB({type:i});static#e=this.\u0275inj=a.cJS({imports:[h.ez,$o.K,ai.UX,Xo,ti.UteisModule,ei.AtividadeModule]})}return i})();a.B6R(fa.H,[h.O5,C.M,P.a,U.b,K.z,Za.n,Da.Q,J.a,y.V,z.m,M.k,B.p,oi.Y,ii.l,E.F,Aa.h,W],[])}}]);